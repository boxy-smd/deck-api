{"version":3,"sources":["../../../../src/modules/comments/controllers/comments.controller.ts"],"sourcesContent":["import { makeCommentOnProjectUseCase } from '@/interface/factories/comments/make-comment-on-project-use-case'\r\nimport { makeDeleteCommentUseCase } from '@/interface/factories/comments/make-delete-comment-use-case'\r\nimport { makeReportCommentUseCase } from '@/interface/factories/comments/make-report-comment-use-case'\r\nimport { JwtAuthGuard } from '@/modules/auth/guards/jwt-auth.guard'\r\nimport {\r\n  BadRequestException,\r\n  Body,\r\n  Controller,\r\n  Delete,\r\n  ForbiddenException,\r\n  HttpCode,\r\n  HttpStatus,\r\n  NotFoundException,\r\n  Param,\r\n  Post,\r\n  Request,\r\n  UseGuards,\r\n} from '@nestjs/common'\r\nimport {\r\n  ApiBearerAuth,\r\n  ApiOperation,\r\n  ApiResponse,\r\n  ApiTags,\r\n} from '@nestjs/swagger'\r\nimport type { CommentOnProjectDto } from '../dto/comment-on-project.dto'\r\nimport type { ReportCommentDto } from '../dto/report-comment.dto'\r\n\r\n@ApiTags('Comments')\r\n@Controller()\r\nexport class CommentsController {\r\n  @Post('projects/:projectId/comments')\r\n  @UseGuards(JwtAuthGuard)\r\n  @ApiBearerAuth()\r\n  @ApiOperation({ summary: 'Comment on a project' })\r\n  @ApiResponse({ status: 201, description: 'Comment created successfully' })\r\n  @ApiResponse({ status: 404, description: 'Project not found' })\r\n  async commentOnProject(\r\n    @Param('projectId') projectId: string,\r\n    @Body() dto: CommentOnProjectDto,\r\n    @Request() req: any,\r\n  ) {\r\n    const commentOnProjectUseCase = makeCommentOnProjectUseCase()\r\n\r\n    const result = await commentOnProjectUseCase.execute({\r\n      projectId,\r\n      content: dto.content,\r\n      authorId: req.user.userId,\r\n    })\r\n\r\n    if (result.isLeft()) {\r\n      const error = result.value\r\n      if (error.statusCode === 404) {\r\n        throw new NotFoundException(error.message)\r\n      }\r\n      if (error.statusCode === 403) {\r\n        throw new ForbiddenException(error.message)\r\n      }\r\n      throw new BadRequestException(error.message)\r\n    }\r\n\r\n    return {\r\n      comment_id: result.value.commentId,\r\n    }\r\n  }\r\n\r\n  @Delete('projects/:projectId/comments/:commentId')\r\n  @UseGuards(JwtAuthGuard)\r\n  @ApiBearerAuth()\r\n  @HttpCode(HttpStatus.NO_CONTENT)\r\n  @ApiOperation({ summary: 'Delete a comment' })\r\n  @ApiResponse({ status: 204, description: 'Comment deleted successfully' })\r\n  @ApiResponse({ status: 403, description: 'Forbidden' })\r\n  @ApiResponse({ status: 404, description: 'Comment not found' })\r\n  async deleteComment(\r\n    @Param('projectId') projectId: string,\r\n    @Param('commentId') commentId: string,\r\n    @Request() req: any,\r\n  ) {\r\n    const deleteCommentUseCase = makeDeleteCommentUseCase()\r\n\r\n    const result = await deleteCommentUseCase.execute({\r\n      authorId: req.user.userId,\r\n      commentId,\r\n      projectId,\r\n    })\r\n\r\n    if (result.isLeft()) {\r\n      const error = result.value\r\n      if (error.statusCode === 404) {\r\n        throw new NotFoundException(error.message)\r\n      }\r\n      if (error.statusCode === 403) {\r\n        throw new ForbiddenException(error.message)\r\n      }\r\n      throw new BadRequestException(error.message)\r\n    }\r\n  }\r\n\r\n  @Post('comments/:commentId/report')\r\n  @UseGuards(JwtAuthGuard)\r\n  @ApiBearerAuth()\r\n  @ApiOperation({ summary: 'Report a comment' })\r\n  @ApiResponse({ status: 201, description: 'Comment reported successfully' })\r\n  @ApiResponse({ status: 404, description: 'Comment not found' })\r\n  async reportComment(\r\n    @Param('commentId') commentId: string,\r\n    @Body() dto: ReportCommentDto,\r\n    @Request() req: any,\r\n  ) {\r\n    const reportCommentUseCase = makeReportCommentUseCase()\r\n\r\n    const result = await reportCommentUseCase.execute({\r\n      authorId: req.user.userId,\r\n      commentId,\r\n      projectId: dto.projectId,\r\n      content: dto.content,\r\n    })\r\n\r\n    if (result.isLeft()) {\r\n      const error = result.value\r\n      if (error.statusCode === 404) {\r\n        throw new NotFoundException(error.message)\r\n      }\r\n      throw new BadRequestException(error.message)\r\n    }\r\n\r\n    return {\r\n      message: 'Comment reported successfully.',\r\n    }\r\n  }\r\n}\r\n"],"names":["CommentsController","commentOnProject","projectId","dto","req","commentOnProjectUseCase","makeCommentOnProjectUseCase","result","execute","content","authorId","user","userId","isLeft","error","value","statusCode","NotFoundException","message","ForbiddenException","BadRequestException","comment_id","commentId","deleteComment","deleteCommentUseCase","makeDeleteCommentUseCase","reportComment","reportCommentUseCase","makeReportCommentUseCase","summary","status","description","NO_CONTENT"],"mappings":";;;;+BA6BaA;;;eAAAA;;;6CA7B+B;0CACH;0CACA;8BACZ;wBActB;yBAMA;;;;;;;;;;;;;;;AAMA,IAAA,AAAMA,qBAAN,MAAMA;IACX,MAMMC,iBACJ,AAAoBC,SAAiB,EACrC,AAAQC,GAAwB,EAChC,AAAWC,GAAQ,EACnB;QACA,MAAMC,0BAA0BC,IAAAA,wDAA2B;QAE3D,MAAMC,SAAS,MAAMF,wBAAwBG,OAAO,CAAC;YACnDN;YACAO,SAASN,IAAIM,OAAO;YACpBC,UAAUN,IAAIO,IAAI,CAACC,MAAM;QAC3B;QAEA,IAAIL,OAAOM,MAAM,IAAI;YACnB,MAAMC,QAAQP,OAAOQ,KAAK;YAC1B,IAAID,MAAME,UAAU,KAAK,KAAK;gBAC5B,MAAM,IAAIC,yBAAiB,CAACH,MAAMI,OAAO;YAC3C;YACA,IAAIJ,MAAME,UAAU,KAAK,KAAK;gBAC5B,MAAM,IAAIG,0BAAkB,CAACL,MAAMI,OAAO;YAC5C;YACA,MAAM,IAAIE,2BAAmB,CAACN,MAAMI,OAAO;QAC7C;QAEA,OAAO;YACLG,YAAYd,OAAOQ,KAAK,CAACO,SAAS;QACpC;IACF;IAEA,MAQMC,cACJ,AAAoBrB,SAAiB,EACrC,AAAoBoB,SAAiB,EACrC,AAAWlB,GAAQ,EACnB;QACA,MAAMoB,uBAAuBC,IAAAA,kDAAwB;QAErD,MAAMlB,SAAS,MAAMiB,qBAAqBhB,OAAO,CAAC;YAChDE,UAAUN,IAAIO,IAAI,CAACC,MAAM;YACzBU;YACApB;QACF;QAEA,IAAIK,OAAOM,MAAM,IAAI;YACnB,MAAMC,QAAQP,OAAOQ,KAAK;YAC1B,IAAID,MAAME,UAAU,KAAK,KAAK;gBAC5B,MAAM,IAAIC,yBAAiB,CAACH,MAAMI,OAAO;YAC3C;YACA,IAAIJ,MAAME,UAAU,KAAK,KAAK;gBAC5B,MAAM,IAAIG,0BAAkB,CAACL,MAAMI,OAAO;YAC5C;YACA,MAAM,IAAIE,2BAAmB,CAACN,MAAMI,OAAO;QAC7C;IACF;IAEA,MAMMQ,cACJ,AAAoBJ,SAAiB,EACrC,AAAQnB,GAAqB,EAC7B,AAAWC,GAAQ,EACnB;QACA,MAAMuB,uBAAuBC,IAAAA,kDAAwB;QAErD,MAAMrB,SAAS,MAAMoB,qBAAqBnB,OAAO,CAAC;YAChDE,UAAUN,IAAIO,IAAI,CAACC,MAAM;YACzBU;YACApB,WAAWC,IAAID,SAAS;YACxBO,SAASN,IAAIM,OAAO;QACtB;QAEA,IAAIF,OAAOM,MAAM,IAAI;YACnB,MAAMC,QAAQP,OAAOQ,KAAK;YAC1B,IAAID,MAAME,UAAU,KAAK,KAAK;gBAC5B,MAAM,IAAIC,yBAAiB,CAACH,MAAMI,OAAO;YAC3C;YACA,MAAM,IAAIE,2BAAmB,CAACN,MAAMI,OAAO;QAC7C;QAEA,OAAO;YACLA,SAAS;QACX;IACF;AACF;;;;;;QAjGkBW,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;QAC1BD,QAAQ;QAAKC,aAAa;;;;;;;;;;;;;;;;;6CAiCpBC;;QACLH,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;QAC1BD,QAAQ;QAAKC,aAAa;;;QAC1BD,QAAQ;QAAKC,aAAa;;;;;;;;;;;;;;;;;;QA6BzBF,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;QAC1BD,QAAQ;QAAKC,aAAa"}