{"version":3,"sources":["../../../../src/modules/projects/controllers/projects.controller.ts"],"sourcesContent":["import { makeDeleteProjectUseCase } from '@/interface/factories/projects/make-delete-project-use-case'\r\nimport { makeFetchPostsUseCase } from '@/interface/factories/projects/make-fetch-posts-use-case'\r\nimport { makeFilterPostsByQueryUseCase } from '@/interface/factories/projects/make-filter-posts-by-query-use-case'\r\nimport { makeGetProjectUseCase } from '@/interface/factories/projects/make-get-project-use-case'\r\nimport { makePublishProjectUseCase } from '@/interface/factories/projects/make-publish-project-use-case'\r\nimport { makeSearchPostsByProfessorNameUseCase } from '@/interface/factories/projects/make-search-posts-by-professor-name-use-case'\r\nimport { makeSearchPostsByTagUseCase } from '@/interface/factories/projects/make-search-posts-by-tag-use-case'\r\nimport { makeSearchPostsByTitleUseCase } from '@/interface/factories/projects/make-search-posts-by-title-use-case'\r\nimport { makeUploadProjectBannerUseCase } from '@/interface/factories/projects/make-upload-project-banner-use-case'\r\nimport { PostPresenter } from '@/interface/http/presenters/post'\r\nimport { ProjectDetailsPresenter } from '@/interface/http/presenters/project-details'\r\nimport { JwtAuthGuard } from '@/modules/auth/guards/jwt-auth.guard'\r\nimport {\r\n  BadRequestException,\r\n  Body,\r\n  ConflictException,\r\n  Controller,\r\n  Delete,\r\n  ForbiddenException,\r\n  Get,\r\n  HttpCode,\r\n  HttpStatus,\r\n  NotFoundException,\r\n  Param,\r\n  Post,\r\n  Query,\r\n  Request,\r\n  UploadedFile,\r\n  UseGuards,\r\n  UseInterceptors,\r\n} from '@nestjs/common'\r\nimport { FileInterceptor } from '@nestjs/platform-express'\r\nimport {\r\n  ApiBearerAuth,\r\n  ApiBody,\r\n  ApiConsumes,\r\n  ApiOperation,\r\n  ApiResponse,\r\n  ApiTags,\r\n} from '@nestjs/swagger'\r\nimport type { FetchPostsDto, FilterPostsDto } from '../dto/fetch-posts.dto'\r\nimport type { PublishProjectDto } from '../dto/publish-project.dto'\r\n\r\n@ApiTags('Projects')\r\n@Controller()\r\nexport class ProjectsController {\r\n  @Post('projects')\r\n  @UseGuards(JwtAuthGuard)\r\n  @ApiBearerAuth()\r\n  @ApiOperation({ summary: 'Publish a project' })\r\n  @ApiResponse({ status: 201, description: 'Project published successfully' })\r\n  @ApiResponse({ status: 400, description: 'Bad request' })\r\n  @ApiResponse({ status: 404, description: 'Resource not found' })\r\n  async publishProject(@Body() dto: PublishProjectDto, @Request() req: any) {\r\n    const publishProjectUseCase = makePublishProjectUseCase()\r\n\r\n    const result = await publishProjectUseCase.execute({\r\n      title: dto.title,\r\n      description: dto.description,\r\n      bannerUrl: dto.bannerUrl,\r\n      content: dto.content,\r\n      publishedYear: dto.publishedYear,\r\n      semester: dto.semester,\r\n      allowComments: dto.allowComments,\r\n      authorId: req.user.userId,\r\n      subjectId: dto.subjectId,\r\n      trailsIds: dto.trailsIds,\r\n      professorsIds: dto.professorsIds,\r\n      draftId: dto.draftId,\r\n    })\r\n\r\n    if (result.isLeft()) {\r\n      const error = result.value\r\n      if (error.statusCode === 404) {\r\n        throw new NotFoundException(error.message)\r\n      }\r\n      if (error.statusCode === 409) {\r\n        throw new ConflictException(error.message)\r\n      }\r\n      throw new BadRequestException(error.message)\r\n    }\r\n\r\n    return {\r\n      project_id: result.value.projectId,\r\n    }\r\n  }\r\n\r\n  @Get('posts')\r\n  @ApiOperation({ summary: 'Fetch posts' })\r\n  @ApiResponse({ status: 200, description: 'Posts retrieved successfully' })\r\n  async fetchPosts(@Query() query: FetchPostsDto) {\r\n    const fetchPostsUseCase = makeFetchPostsUseCase()\r\n\r\n    const result = await fetchPostsUseCase.execute()\r\n\r\n    return {\r\n      posts: result.map(PostPresenter.toHTTP),\r\n    }\r\n  }\r\n\r\n  @Get('posts/search')\r\n  @ApiOperation({ summary: 'Search/Filter posts' })\r\n  @ApiResponse({ status: 200, description: 'Posts retrieved successfully' })\r\n  async filterPosts(@Query() filter: FilterPostsDto) {\r\n    let posts: any[] = []\r\n\r\n    if (filter.query) {\r\n      const filterPostsUseCase = makeFilterPostsByQueryUseCase()\r\n\r\n      const result = await filterPostsUseCase.execute({ query: filter.query })\r\n\r\n      if (result.isRight()) {\r\n        posts = result.value\r\n      }\r\n    } else if (filter.title) {\r\n      const searchUseCase = makeSearchPostsByTitleUseCase()\r\n      const result = await searchUseCase.execute({ title: filter.title })\r\n      posts = result\r\n    } else if (filter.professor) {\r\n      const searchUseCase = makeSearchPostsByProfessorNameUseCase()\r\n      const result = await searchUseCase.execute({\r\n        professorName: filter.professor,\r\n      })\r\n      posts = result\r\n    } else if (filter.tag) {\r\n      const searchUseCase = makeSearchPostsByTagUseCase()\r\n      const result = await searchUseCase.execute({ tag: filter.tag })\r\n      posts = result\r\n    } else {\r\n      const fetchPostsUseCase = makeFetchPostsUseCase()\r\n      const result = await fetchPostsUseCase.execute()\r\n      if (result.isRight()) {\r\n        posts = result.value\r\n      }\r\n    }\r\n\r\n    return {\r\n      posts: posts.map(PostPresenter.toHTTP),\r\n    }\r\n  }\r\n\r\n  @Get('projects/:projectId')\r\n  @ApiOperation({ summary: 'Get project details' })\r\n  @ApiResponse({ status: 200, description: 'Project retrieved successfully' })\r\n  @ApiResponse({ status: 404, description: 'Project not found' })\r\n  async getProject(@Param('projectId') projectId: string) {\r\n    const getProjectUseCase = makeGetProjectUseCase()\r\n\r\n    const result = await getProjectUseCase.execute({ projectId })\r\n\r\n    if (result.isLeft()) {\r\n      const error = result.value\r\n      if (error.statusCode === 404) {\r\n        throw new NotFoundException(error.message)\r\n      }\r\n      throw new BadRequestException(error.message)\r\n    }\r\n\r\n    return ProjectDetailsPresenter.toHTTP(result.value)\r\n  }\r\n\r\n  @Delete('projects/:projectId')\r\n  @UseGuards(JwtAuthGuard)\r\n  @ApiBearerAuth()\r\n  @HttpCode(HttpStatus.NO_CONTENT)\r\n  @ApiOperation({ summary: 'Delete a project' })\r\n  @ApiResponse({ status: 204, description: 'Project deleted successfully' })\r\n  @ApiResponse({ status: 403, description: 'Forbidden' })\r\n  @ApiResponse({ status: 404, description: 'Project not found' })\r\n  async deleteProject(\r\n    @Param('projectId') projectId: string,\r\n    @Request() req: any,\r\n  ) {\r\n    const deleteProjectUseCase = makeDeleteProjectUseCase()\r\n\r\n    const result = await deleteProjectUseCase.execute({\r\n      projectId,\r\n      studentId: req.user.userId,\r\n    })\r\n\r\n    if (result.isLeft()) {\r\n      const error = result.value\r\n      if (error.statusCode === 404) {\r\n        throw new NotFoundException(error.message)\r\n      }\r\n      if (error.statusCode === 403) {\r\n        throw new ForbiddenException(error.message)\r\n      }\r\n      throw new BadRequestException(error.message)\r\n    }\r\n  }\r\n\r\n  @Post('projects/:projectId/banner')\r\n  @UseGuards(JwtAuthGuard)\r\n  @UseInterceptors(FileInterceptor('file'))\r\n  @ApiBearerAuth()\r\n  @ApiConsumes('multipart/form-data')\r\n  @ApiOperation({ summary: 'Upload project banner' })\r\n  @ApiBody({\r\n    schema: {\r\n      type: 'object',\r\n      properties: {\r\n        file: {\r\n          type: 'string',\r\n          format: 'binary',\r\n        },\r\n      },\r\n    },\r\n  })\r\n  @ApiResponse({ status: 200, description: 'Banner uploaded successfully' })\r\n  @ApiResponse({ status: 404, description: 'Project not found' })\r\n  async uploadBanner(\r\n    @Param('projectId') projectId: string,\r\n    @UploadedFile() file: Express.Multer.File,\r\n  ) {\r\n    if (!file) {\r\n      throw new BadRequestException('File is required')\r\n    }\r\n\r\n    const uploadUseCase = makeUploadProjectBannerUseCase()\r\n\r\n    const result = await uploadUseCase.execute({\r\n      projectId,\r\n      filename: file.originalname,\r\n      image: file.buffer,\r\n    })\r\n\r\n    if (result.isLeft()) {\r\n      const error = result.value\r\n      if (error.statusCode === 404) {\r\n        throw new NotFoundException(error.message)\r\n      }\r\n      throw new BadRequestException(error.message)\r\n    }\r\n\r\n    return { message: 'Banner uploaded successfully' }\r\n  }\r\n}\r\n"],"names":["ProjectsController","publishProject","dto","req","publishProjectUseCase","makePublishProjectUseCase","result","execute","title","description","bannerUrl","content","publishedYear","semester","allowComments","authorId","user","userId","subjectId","trailsIds","professorsIds","draftId","isLeft","error","value","statusCode","NotFoundException","message","ConflictException","BadRequestException","project_id","projectId","fetchPosts","query","fetchPostsUseCase","makeFetchPostsUseCase","posts","map","PostPresenter","toHTTP","filterPosts","filter","filterPostsUseCase","makeFilterPostsByQueryUseCase","isRight","searchUseCase","makeSearchPostsByTitleUseCase","professor","makeSearchPostsByProfessorNameUseCase","professorName","tag","makeSearchPostsByTagUseCase","getProject","getProjectUseCase","makeGetProjectUseCase","ProjectDetailsPresenter","deleteProject","deleteProjectUseCase","makeDeleteProjectUseCase","studentId","ForbiddenException","uploadBanner","file","uploadUseCase","makeUploadProjectBannerUseCase","filename","originalname","image","buffer","summary","status","NO_CONTENT","schema","type","properties","format"],"mappings":"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"}