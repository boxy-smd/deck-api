{"version":3,"sources":["../../../../../src/infra/database/prisma/repositories/comments-repository.ts"],"sourcesContent":["import type { CommentsRepository } from '@/domain/interaction/application/repositories/comments-repository'\nimport type { Comment } from '@/domain/interaction/enterprise/entities/comment'\nimport type { CommentWithAuthor } from '@/domain/interaction/enterprise/entities/value-objects/comment-with-author'\nimport { prisma } from '../client'\nimport { PrismaCommentMapper } from '../mappers/prisma-comment-mapper'\nimport type { PrismaReportsRepository } from './reports-repository'\n\nexport class PrismaCommentsRepository implements CommentsRepository {\n  constructor(private readonly reportsRepository: PrismaReportsRepository) {}\n\n  async findById(id: string): Promise<Comment | null> {\n    const data = await prisma.comment.findUnique({\n      where: {\n        id,\n      },\n    })\n\n    if (!data) return null\n\n    return PrismaCommentMapper.toEntity(data)\n  }\n\n  async findByProjectId(projectId: string): Promise<Comment[]> {\n    const data = await prisma.comment.findMany({\n      where: {\n        projectId,\n      },\n    })\n\n    return data.map(PrismaCommentMapper.toEntity)\n  }\n\n  async findManyByProjectIdWithAuthors(\n    projectId: string,\n  ): Promise<CommentWithAuthor[]> {\n    const data = await prisma.comment.findMany({\n      where: {\n        projectId,\n      },\n      include: {\n        author: {\n          select: {\n            name: true,\n            username: true,\n            profileUrl: true,\n          },\n        },\n      },\n    })\n\n    return data.map(PrismaCommentMapper.toEntityWithAuthor)\n  }\n\n  async findAll(): Promise<Comment[]> {\n    const data = await prisma.comment.findMany()\n\n    return data.map(PrismaCommentMapper.toEntity)\n  }\n\n  async existsById(id: string): Promise<boolean> {\n    const count = await prisma.comment.count({\n      where: {\n        id,\n      },\n    })\n\n    return count > 0\n  }\n\n  async create(comment: Comment): Promise<void> {\n    const data = PrismaCommentMapper.toPrisma(comment)\n\n    await prisma.comment.create({\n      data,\n    })\n  }\n\n  async save(comment: Comment): Promise<void> {\n    const data = PrismaCommentMapper.toPrisma(comment)\n\n    await prisma.comment.update({\n      where: {\n        id: data.id,\n      },\n      data,\n    })\n  }\n\n  async delete(comment: Comment): Promise<void> {\n    await this.reportsRepository.deleteManyByCommentId(comment.id.toString())\n\n    await prisma.comment.delete({\n      where: {\n        id: comment.id.toString(),\n      },\n    })\n  }\n\n  async deleteById(id: string): Promise<void> {\n    await prisma.comment.delete({\n      where: {\n        id,\n      },\n    })\n  }\n\n  async deleteManyByProjectId(projectId: string): Promise<void> {\n    await prisma.comment.deleteMany({\n      where: {\n        projectId,\n      },\n    })\n  }\n}\n"],"names":["PrismaCommentsRepository","findById","id","data","prisma","comment","findUnique","where","PrismaCommentMapper","toEntity","findByProjectId","projectId","findMany","map","findManyByProjectIdWithAuthors","include","author","select","name","username","profileUrl","toEntityWithAuthor","findAll","existsById","count","create","toPrisma","save","update","delete","reportsRepository","deleteManyByCommentId","toString","deleteById","deleteManyByProjectId","deleteMany"],"mappings":";;;;+BAOaA;;;eAAAA;;;wBAJU;qCACa;AAG7B,IAAA,AAAMA,2BAAN,MAAMA;IAGX,MAAMC,SAASC,EAAU,EAA2B;QAClD,MAAMC,OAAO,MAAMC,cAAM,CAACC,OAAO,CAACC,UAAU,CAAC;YAC3CC,OAAO;gBACLL;YACF;QACF;QAEA,IAAI,CAACC,MAAM,OAAO;QAElB,OAAOK,wCAAmB,CAACC,QAAQ,CAACN;IACtC;IAEA,MAAMO,gBAAgBC,SAAiB,EAAsB;QAC3D,MAAMR,OAAO,MAAMC,cAAM,CAACC,OAAO,CAACO,QAAQ,CAAC;YACzCL,OAAO;gBACLI;YACF;QACF;QAEA,OAAOR,KAAKU,GAAG,CAACL,wCAAmB,CAACC,QAAQ;IAC9C;IAEA,MAAMK,+BACJH,SAAiB,EACa;QAC9B,MAAMR,OAAO,MAAMC,cAAM,CAACC,OAAO,CAACO,QAAQ,CAAC;YACzCL,OAAO;gBACLI;YACF;YACAI,SAAS;gBACPC,QAAQ;oBACNC,QAAQ;wBACNC,MAAM;wBACNC,UAAU;wBACVC,YAAY;oBACd;gBACF;YACF;QACF;QAEA,OAAOjB,KAAKU,GAAG,CAACL,wCAAmB,CAACa,kBAAkB;IACxD;IAEA,MAAMC,UAA8B;QAClC,MAAMnB,OAAO,MAAMC,cAAM,CAACC,OAAO,CAACO,QAAQ;QAE1C,OAAOT,KAAKU,GAAG,CAACL,wCAAmB,CAACC,QAAQ;IAC9C;IAEA,MAAMc,WAAWrB,EAAU,EAAoB;QAC7C,MAAMsB,QAAQ,MAAMpB,cAAM,CAACC,OAAO,CAACmB,KAAK,CAAC;YACvCjB,OAAO;gBACLL;YACF;QACF;QAEA,OAAOsB,QAAQ;IACjB;IAEA,MAAMC,OAAOpB,OAAgB,EAAiB;QAC5C,MAAMF,OAAOK,wCAAmB,CAACkB,QAAQ,CAACrB;QAE1C,MAAMD,cAAM,CAACC,OAAO,CAACoB,MAAM,CAAC;YAC1BtB;QACF;IACF;IAEA,MAAMwB,KAAKtB,OAAgB,EAAiB;QAC1C,MAAMF,OAAOK,wCAAmB,CAACkB,QAAQ,CAACrB;QAE1C,MAAMD,cAAM,CAACC,OAAO,CAACuB,MAAM,CAAC;YAC1BrB,OAAO;gBACLL,IAAIC,KAAKD,EAAE;YACb;YACAC;QACF;IACF;IAEA,MAAM0B,OAAOxB,OAAgB,EAAiB;QAC5C,MAAM,IAAI,CAACyB,iBAAiB,CAACC,qBAAqB,CAAC1B,QAAQH,EAAE,CAAC8B,QAAQ;QAEtE,MAAM5B,cAAM,CAACC,OAAO,CAACwB,MAAM,CAAC;YAC1BtB,OAAO;gBACLL,IAAIG,QAAQH,EAAE,CAAC8B,QAAQ;YACzB;QACF;IACF;IAEA,MAAMC,WAAW/B,EAAU,EAAiB;QAC1C,MAAME,cAAM,CAACC,OAAO,CAACwB,MAAM,CAAC;YAC1BtB,OAAO;gBACLL;YACF;QACF;IACF;IAEA,MAAMgC,sBAAsBvB,SAAiB,EAAiB;QAC5D,MAAMP,cAAM,CAACC,OAAO,CAAC8B,UAAU,CAAC;YAC9B5B,OAAO;gBACLI;YACF;QACF;IACF;IAxGA,YAAY,AAAiBmB,iBAA0C,CAAE;aAA5CA,oBAAAA;IAA6C;AAyG5E"}