{"version":3,"sources":["../../../../../src/infra/database/prisma/repositories/students-repository.ts"],"sourcesContent":["import type { UsersRepository } from '@/domain/authentication/application/repositories/users-repository'\nimport type { User } from '@/domain/authentication/enterprise/entities/user'\nimport { prisma } from '../client'\nimport { PrismaStudentMapper } from '../mappers/prisma-student-mapper'\n\nexport class PrismaStudentsRepository implements UsersRepository {\n  async findById(id: string): Promise<User | null> {\n    const student = await prisma.user.findUnique({\n      where: { id },\n      include: { \n        trail: {\n          include: {\n            trail: true\n          }\n        },\n        studentProfile: true\n      },\n    })\n\n    if (!student) return null\n\n    return PrismaStudentMapper.toEntity(student)\n  }\n\n  async findByName(name: string): Promise<User | null> {\n    const student = await prisma.user.findFirst({\n      where: { name },\n      include: { \n        trail: {\n          include: {\n            trail: true\n          }\n        },\n        studentProfile: true\n      },\n    })\n\n    if (!student) return null\n\n    return PrismaStudentMapper.toEntity(student)\n  }\n\n  async findByEmail(email: string): Promise<User | null> {\n    const student = await prisma.user.findFirst({\n      where: { email },\n      include: { \n        trail: {\n          include: {\n            trail: true\n          }\n        },\n        studentProfile: true\n      },\n    })\n\n    if (!student) return null\n\n    return PrismaStudentMapper.toEntity(student)\n  }\n\n  async findByUsername(username: string): Promise<User | null> {\n    const student = await prisma.user.findFirst({\n      where: { username },\n      include: { \n        trail: {\n          include: {\n            trail: true\n          }\n        },\n        studentProfile: true\n      },\n    })\n\n    if (!student) return null\n\n   return PrismaStudentMapper.toEntity(student)\n  }\n\n  async findManyByName(name: string): Promise<User[]> {\n    const students = await prisma.user.findMany({\n      where: {\n        name: { contains: name, mode: 'insensitive' },\n        username: name.startsWith('@')\n          ? { contains: name.slice(1), mode: 'insensitive' }\n          : undefined,\n      },\n      include: { \n        trail: {\n          include: {\n            trail: true\n          }\n        },\n        studentProfile: true\n      },\n    })\n\n    return students.map(s => \n      PrismaStudentMapper.toEntity(s)\n    )\n  }\n\n  async findAll(): Promise<User[]> {\n    const students = await prisma.user.findMany({\n      include: { \n        trail: {\n          include: {\n            trail: true\n          }\n        },\n        studentProfile: true\n      },\n    })\n\n    return students.map(s => \n      PrismaStudentMapper.toEntity(s)\n    )\n  }\n\n  async existsById(id: string): Promise<boolean> {\n    const count = await prisma.user.count({\n      where: { id },\n    })\n\n    return count > 0\n  }\n\n  async create(student: User): Promise<void> {\n    const data = PrismaStudentMapper.toPrisma(student)\n    await prisma.user.create({ data })\n  }\n\n  async save(student: User): Promise<void> {\n    const data = PrismaStudentMapper.toPrismaUpdate(student)\n\n    await prisma.user.update({\n      where: { id: student.id.toString() },\n      data,\n    })\n  }\n\n  async delete(student: User): Promise<void> {\n    await prisma.user.delete({\n      where: { id: student.id.toString() },\n    })\n  }\n\n  async deleteById(id: string): Promise<void> {\n    await prisma.user.delete({\n      where: { id },\n    })\n  }\n}\n"],"names":["PrismaStudentsRepository","findById","id","student","prisma","user","findUnique","where","include","trail","studentProfile","PrismaStudentMapper","toEntity","findByName","name","findFirst","findByEmail","email","findByUsername","username","findManyByName","students","findMany","contains","mode","startsWith","slice","undefined","map","s","findAll","existsById","count","create","data","toPrisma","save","toPrismaUpdate","update","toString","delete","deleteById"],"mappings":"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"}