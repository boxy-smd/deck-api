{"version":3,"sources":["../../../../../src/infra/database/prisma/mappers/prisma-student-mapper.ts"],"sourcesContent":["import type { Prisma, User as UserRaw } from '@prisma/client'\n\nimport { StudentProfile } from '@/domain/authentication/enterprise/entities/student-profile'\nimport { User } from '@/domain/authentication/enterprise/entities/user'\nimport { Email } from '@/domain/authentication/enterprise/value-objects/email'\nimport { Semester } from '@/domain/authentication/enterprise/value-objects/semester'\nimport type { UserRole } from '@/domain/authentication/enterprise/value-objects/user-role'\nimport type { UserStatus } from '@/domain/authentication/enterprise/value-objects/user-status'\nimport { Username } from '@/domain/authentication/enterprise/value-objects/username'\nimport { UniqueEntityID } from '@/shared/kernel/unique-entity-id'\n\n// biome-ignore lint/complexity/noStaticOnlyClass: This class is a mapper and should have only static methods\nexport class PrismaStudentMapper {\n  static toEntity(\n    raw: UserRaw & {\n      studentProfile?: {\n        semester: number\n      } | null\n      trail?: {\n        trail: {\n          id: string\n        }\n      }[]\n    },\n  ): User {\n    const usernameResult = Username.create(raw.username)\n    if (usernameResult.isLeft()) {\n      throw usernameResult.value\n    }\n\n    const email = Email.create(raw.email)\n\n    let profile: StudentProfile | undefined\n    if (raw.studentProfile) {\n      const semesterResult = Semester.create(raw.studentProfile.semester)\n      if (semesterResult.isLeft()) {\n        throw semesterResult.value\n      }\n\n      profile = StudentProfile.create(\n        {\n          semester: semesterResult.value,\n          trailsIds: new Set(\n            raw.trail?.map(t => UniqueEntityID.create(t.trail.id)) || [],\n          ),\n        },\n        UniqueEntityID.create(raw.id),\n      )\n    }\n\n    return User.create(\n      {\n        name: raw.name,\n        username: usernameResult.value,\n        email,\n        passwordHash: raw.passwordHash,\n        about: raw.about ?? undefined,\n        profileUrl: raw.profileUrl ?? undefined,\n        role: raw.role as UserRole,\n        status: raw.status as UserStatus,\n        profile,\n      },\n      UniqueEntityID.create(raw.id),\n    )\n  }\n\n  static toPrisma(user: User): Prisma.UserCreateInput {\n    return {\n      id: user.id.toString(),\n      name: user.name,\n      username: user.username.value,\n      email: user.email.value,\n      passwordHash: user.passwordHash,\n      about: user.about ?? undefined,\n      profileUrl: user.profileUrl ?? undefined,\n      role: user.role,\n      status: user.status,\n      studentProfile: user.profile ? {\n        create: {\n          semester: user.profile.semester.value,\n        }\n      } : undefined,\n      trail: user.profile && user.profile.trailsIds.length > 0 ? {\n        create: user.profile.trailsIds\n          .filter(trailId => trailId != null)\n          .map(trailId => ({\n            trailId: trailId.toString(),\n          })),\n      } : undefined,\n    }\n  }\n\n  static toPrismaUpdate(user: User): Prisma.UserUncheckedUpdateInput {\n    return {\n      name: user.name,\n      username: user.username.value,\n      email: user.email.value,\n      passwordHash: user.passwordHash,\n      about: user.about ?? undefined,\n      profileUrl: user.profileUrl ?? undefined,\n      role: user.role,\n      status: user.status,\n    }\n  }\n}\n"],"names":["PrismaStudentMapper","toEntity","raw","usernameResult","Username","create","username","isLeft","value","email","Email","profile","studentProfile","semesterResult","Semester","semester","StudentProfile","trailsIds","Set","trail","map","t","UniqueEntityID","id","User","name","passwordHash","about","undefined","profileUrl","role","status","toPrisma","user","toString","length","filter","trailId","toPrismaUpdate"],"mappings":";;;;+BAYaA;;;eAAAA;;;gCAVkB;sBACV;uBACC;0BACG;0BAGA;gCACM;AAGxB,IAAA,AAAMA,sBAAN,MAAMA;IACX,OAAOC,SACLC,GASC,EACK;QACN,MAAMC,iBAAiBC,kBAAQ,CAACC,MAAM,CAACH,IAAII,QAAQ;QACnD,IAAIH,eAAeI,MAAM,IAAI;YAC3B,MAAMJ,eAAeK,KAAK;QAC5B;QAEA,MAAMC,QAAQC,YAAK,CAACL,MAAM,CAACH,IAAIO,KAAK;QAEpC,IAAIE;QACJ,IAAIT,IAAIU,cAAc,EAAE;YACtB,MAAMC,iBAAiBC,kBAAQ,CAACT,MAAM,CAACH,IAAIU,cAAc,CAACG,QAAQ;YAClE,IAAIF,eAAeN,MAAM,IAAI;gBAC3B,MAAMM,eAAeL,KAAK;YAC5B;YAEAG,UAAUK,8BAAc,CAACX,MAAM,CAC7B;gBACEU,UAAUF,eAAeL,KAAK;gBAC9BS,WAAW,IAAIC,IACbhB,IAAIiB,KAAK,EAAEC,IAAIC,CAAAA,IAAKC,8BAAc,CAACjB,MAAM,CAACgB,EAAEF,KAAK,CAACI,EAAE,MAAM,EAAE;YAEhE,GACAD,8BAAc,CAACjB,MAAM,CAACH,IAAIqB,EAAE;QAEhC;QAEA,OAAOC,UAAI,CAACnB,MAAM,CAChB;YACEoB,MAAMvB,IAAIuB,IAAI;YACdnB,UAAUH,eAAeK,KAAK;YAC9BC;YACAiB,cAAcxB,IAAIwB,YAAY;YAC9BC,OAAOzB,IAAIyB,KAAK,IAAIC;YACpBC,YAAY3B,IAAI2B,UAAU,IAAID;YAC9BE,MAAM5B,IAAI4B,IAAI;YACdC,QAAQ7B,IAAI6B,MAAM;YAClBpB;QACF,GACAW,8BAAc,CAACjB,MAAM,CAACH,IAAIqB,EAAE;IAEhC;IAEA,OAAOS,SAASC,IAAU,EAA0B;QAClD,OAAO;YACLV,IAAIU,KAAKV,EAAE,CAACW,QAAQ;YACpBT,MAAMQ,KAAKR,IAAI;YACfnB,UAAU2B,KAAK3B,QAAQ,CAACE,KAAK;YAC7BC,OAAOwB,KAAKxB,KAAK,CAACD,KAAK;YACvBkB,cAAcO,KAAKP,YAAY;YAC/BC,OAAOM,KAAKN,KAAK,IAAIC;YACrBC,YAAYI,KAAKJ,UAAU,IAAID;YAC/BE,MAAMG,KAAKH,IAAI;YACfC,QAAQE,KAAKF,MAAM;YACnBnB,gBAAgBqB,KAAKtB,OAAO,GAAG;gBAC7BN,QAAQ;oBACNU,UAAUkB,KAAKtB,OAAO,CAACI,QAAQ,CAACP,KAAK;gBACvC;YACF,IAAIoB;YACJT,OAAOc,KAAKtB,OAAO,IAAIsB,KAAKtB,OAAO,CAACM,SAAS,CAACkB,MAAM,GAAG,IAAI;gBACzD9B,QAAQ4B,KAAKtB,OAAO,CAACM,SAAS,CAC3BmB,MAAM,CAACC,CAAAA,UAAWA,WAAW,MAC7BjB,GAAG,CAACiB,CAAAA,UAAY,CAAA;wBACfA,SAASA,QAAQH,QAAQ;oBAC3B,CAAA;YACJ,IAAIN;QACN;IACF;IAEA,OAAOU,eAAeL,IAAU,EAAmC;QACjE,OAAO;YACLR,MAAMQ,KAAKR,IAAI;YACfnB,UAAU2B,KAAK3B,QAAQ,CAACE,KAAK;YAC7BC,OAAOwB,KAAKxB,KAAK,CAACD,KAAK;YACvBkB,cAAcO,KAAKP,YAAY;YAC/BC,OAAOM,KAAKN,KAAK,IAAIC;YACrBC,YAAYI,KAAKJ,UAAU,IAAID;YAC/BE,MAAMG,KAAKH,IAAI;YACfC,QAAQE,KAAKF,MAAM;QACrB;IACF;AACF"}