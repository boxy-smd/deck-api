{"version":3,"sources":["../../../../../src/interface/http/controllers/comments/report.controller.e2e-spec.ts"],"sourcesContent":["import request from 'supertest'\n\nimport { app } from '@/app'\nimport { PrismaCommentsRepository } from '@/infra/database/prisma/repositories/comments-repository'\nimport { PrismaProjectsRepository } from '@/infra/database/prisma/repositories/projects-repository'\nimport { PrismaReportsRepository } from '@/infra/database/prisma/repositories/reports-repository'\nimport { PrismaSubjectsRepository } from '@/infra/database/prisma/repositories/subjects-repository'\nimport { UniqueEntityID } from '@/shared/kernel/unique-entity-id'\nimport { createAndAuthenticateStudent } from 'test/e2e/create-and-authenticate-students'\nimport { makeComment } from 'test/factories/make-comment'\nimport { makeProject } from 'test/factories/make-project'\nimport { makeSubject } from 'test/factories/make-subject'\n\ndescribe('report comment (e2e)', () => {\n  beforeAll(async () => {\n    await app.ready()\n  })\n\n  afterAll(async () => {\n    await app.close()\n  })\n\n  it('should be able to report a comment', async () => {\n    const { studentId, token, trail } = await createAndAuthenticateStudent()\n\n    const subjectsRepository = new PrismaSubjectsRepository()\n    const projectsRepository = new PrismaProjectsRepository()\n    const reportsRepository = new PrismaReportsRepository()\n    const commentsRepository = new PrismaCommentsRepository(reportsRepository)\n\n    const subject = makeSubject()\n    const project = makeProject({\n      authorId: new UniqueEntityID(studentId),\n      subjectId: subject.id,\n      trails: new Set([trail.id]),\n    })\n    const comment = makeComment({\n      authorId: new UniqueEntityID(studentId),\n      projectId: project.id,\n    })\n\n    await subjectsRepository.create(subject)\n    await projectsRepository.create(project)\n    await commentsRepository.create(comment)\n\n    const result = await request(app.server)\n      .post(`/reports/${comment.id.toString()}`)\n      .set('Authorization', `Bearer ${token}`)\n      .send({\n        content: 'This comment is offensive',\n        projectId: project.id.toString(),\n      })\n\n    expect(result.status).toBe(201)\n    expect(result.body).toEqual({\n      message: 'Comment reported successfully.',\n    })\n  })\n})\n"],"names":["describe","beforeAll","app","ready","afterAll","close","it","studentId","token","trail","createAndAuthenticateStudent","subjectsRepository","PrismaSubjectsRepository","projectsRepository","PrismaProjectsRepository","reportsRepository","PrismaReportsRepository","commentsRepository","PrismaCommentsRepository","subject","makeSubject","project","makeProject","authorId","UniqueEntityID","subjectId","id","trails","Set","comment","makeComment","projectId","create","result","request","server","post","toString","set","send","content","expect","status","toBe","body","toEqual","message"],"mappings":";;;;kEAAoB;qBAEA;oCACqB;oCACA;mCACD;oCACC;gCACV;+CACc;6BACjB;6BACA;6BACA;;;;;;AAE5BA,SAAS,wBAAwB;IAC/BC,UAAU;QACR,MAAMC,QAAG,CAACC,KAAK;IACjB;IAEAC,SAAS;QACP,MAAMF,QAAG,CAACG,KAAK;IACjB;IAEAC,GAAG,sCAAsC;QACvC,MAAM,EAAEC,SAAS,EAAEC,KAAK,EAAEC,KAAK,EAAE,GAAG,MAAMC,IAAAA,2DAA4B;QAEtE,MAAMC,qBAAqB,IAAIC,4CAAwB;QACvD,MAAMC,qBAAqB,IAAIC,4CAAwB;QACvD,MAAMC,oBAAoB,IAAIC,0CAAuB;QACrD,MAAMC,qBAAqB,IAAIC,4CAAwB,CAACH;QAExD,MAAMI,UAAUC,IAAAA,wBAAW;QAC3B,MAAMC,UAAUC,IAAAA,wBAAW,EAAC;YAC1BC,UAAU,IAAIC,8BAAc,CAACjB;YAC7BkB,WAAWN,QAAQO,EAAE;YACrBC,QAAQ,IAAIC,IAAI;gBAACnB,MAAMiB,EAAE;aAAC;QAC5B;QACA,MAAMG,UAAUC,IAAAA,wBAAW,EAAC;YAC1BP,UAAU,IAAIC,8BAAc,CAACjB;YAC7BwB,WAAWV,QAAQK,EAAE;QACvB;QAEA,MAAMf,mBAAmBqB,MAAM,CAACb;QAChC,MAAMN,mBAAmBmB,MAAM,CAACX;QAChC,MAAMJ,mBAAmBe,MAAM,CAACH;QAEhC,MAAMI,SAAS,MAAMC,IAAAA,kBAAO,EAAChC,QAAG,CAACiC,MAAM,EACpCC,IAAI,CAAC,CAAC,SAAS,EAAEP,QAAQH,EAAE,CAACW,QAAQ,IAAI,EACxCC,GAAG,CAAC,iBAAiB,CAAC,OAAO,EAAE9B,OAAO,EACtC+B,IAAI,CAAC;YACJC,SAAS;YACTT,WAAWV,QAAQK,EAAE,CAACW,QAAQ;QAChC;QAEFI,OAAOR,OAAOS,MAAM,EAAEC,IAAI,CAAC;QAC3BF,OAAOR,OAAOW,IAAI,EAAEC,OAAO,CAAC;YAC1BC,SAAS;QACX;IACF;AACF"}