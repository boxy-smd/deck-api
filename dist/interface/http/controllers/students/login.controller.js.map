{"version":3,"sources":["../../../../../src/interface/http/controllers/students/login.controller.ts"],"sourcesContent":["import type { FastifyReply, FastifyRequest } from 'fastify'\n\nimport { makeLoginUseCase } from '@/interface/factories/students/make-login-use-case'\nimport type { LoginBody } from '@/interface/http/schemas/students/login.schemas'\n\nexport async function login(\n  request: FastifyRequest<{\n    Body: LoginBody\n  }>,\n  reply: FastifyReply,\n) {\n  const { email, password } = request.body\n\n  const loginUseCase = makeLoginUseCase()\n\n  const result = await loginUseCase.execute({\n    email,\n    password,\n  })\n\n  if (result.isLeft()) {\n    const error = result.value\n    return reply.status(error.statusCode).send({ message: error.message })\n  }\n\n  const token = await reply.jwtSign({\n    sign: {\n      sub: result.value.id,\n    },\n  })\n\n  const refreshToken = await reply.jwtSign({\n    sign: {\n      sub: result.value.id,\n      expiresIn: '7d',\n    },\n  })\n\n  return reply\n    .setCookie('refreshToken', refreshToken, {\n      path: '/',\n      secure: true,\n      sameSite: true,\n      httpOnly: true,\n    })\n    .status(200)\n    .send({\n      token,\n    })\n}\n"],"names":["login","request","reply","email","password","body","loginUseCase","makeLoginUseCase","result","execute","isLeft","error","value","status","statusCode","send","message","token","jwtSign","sign","sub","id","refreshToken","expiresIn","setCookie","path","secure","sameSite","httpOnly"],"mappings":";;;;+BAKsBA;;;eAAAA;;;kCAHW;AAG1B,eAAeA,MACpBC,OAEE,EACFC,KAAmB;IAEnB,MAAM,EAAEC,KAAK,EAAEC,QAAQ,EAAE,GAAGH,QAAQI,IAAI;IAExC,MAAMC,eAAeC,IAAAA,kCAAgB;IAErC,MAAMC,SAAS,MAAMF,aAAaG,OAAO,CAAC;QACxCN;QACAC;IACF;IAEA,IAAII,OAAOE,MAAM,IAAI;QACnB,MAAMC,QAAQH,OAAOI,KAAK;QAC1B,OAAOV,MAAMW,MAAM,CAACF,MAAMG,UAAU,EAAEC,IAAI,CAAC;YAAEC,SAASL,MAAMK,OAAO;QAAC;IACtE;IAEA,MAAMC,QAAQ,MAAMf,MAAMgB,OAAO,CAAC;QAChCC,MAAM;YACJC,KAAKZ,OAAOI,KAAK,CAACS,EAAE;QACtB;IACF;IAEA,MAAMC,eAAe,MAAMpB,MAAMgB,OAAO,CAAC;QACvCC,MAAM;YACJC,KAAKZ,OAAOI,KAAK,CAACS,EAAE;YACpBE,WAAW;QACb;IACF;IAEA,OAAOrB,MACJsB,SAAS,CAAC,gBAAgBF,cAAc;QACvCG,MAAM;QACNC,QAAQ;QACRC,UAAU;QACVC,UAAU;IACZ,GACCf,MAAM,CAAC,KACPE,IAAI,CAAC;QACJE;IACF;AACJ"}