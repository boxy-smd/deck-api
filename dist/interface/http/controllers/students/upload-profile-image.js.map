{"version":3,"sources":["../../../../../src/interface/http/controllers/students/upload-profile-image.ts"],"sourcesContent":["import { makeUploadProfileImageUseCase } from '@/interface/factories/students/make-upload-profile-image-use-case'\nimport type { FastifyReply, FastifyRequest } from 'fastify'\nimport type { UpdateProfileImageParams } from '../../schemas/students/upload-profile-image.schemas'\n\nexport async function uploadProfileImage(\n  request: FastifyRequest<{\n    Params: UpdateProfileImageParams\n  }>,\n  reply: FastifyReply,\n) {\n  const { username } = request.params\n  const profileImage = await request.file()\n\n  if (!profileImage) {\n    return reply.code(400).send({ error: 'No image provided.' })\n  }\n\n  const uploadStudentProfileUseCase = makeUploadProfileImageUseCase()\n\n  const { mimetype } = profileImage\n\n  const image = await profileImage.toBuffer()\n\n  const result = await uploadStudentProfileUseCase.execute({\n    filename: `${username}.${mimetype.split('/')[1]}`,\n    image,\n    username,\n  })\n\n  if (result.isLeft()) {\n    const error = result.value\n    return reply.code(error.statusCode).send({ message: error.message })\n  }\n\n  return reply.code(201).send({\n    message: 'Profile image uploaded successfully.',\n  })\n}\n"],"names":["uploadProfileImage","request","reply","username","params","profileImage","file","code","send","error","uploadStudentProfileUseCase","makeUploadProfileImageUseCase","mimetype","image","toBuffer","result","execute","filename","split","isLeft","value","statusCode","message"],"mappings":";;;;+BAIsBA;;;eAAAA;;;+CAJwB;AAIvC,eAAeA,mBACpBC,OAEE,EACFC,KAAmB;IAEnB,MAAM,EAAEC,QAAQ,EAAE,GAAGF,QAAQG,MAAM;IACnC,MAAMC,eAAe,MAAMJ,QAAQK,IAAI;IAEvC,IAAI,CAACD,cAAc;QACjB,OAAOH,MAAMK,IAAI,CAAC,KAAKC,IAAI,CAAC;YAAEC,OAAO;QAAqB;IAC5D;IAEA,MAAMC,8BAA8BC,IAAAA,4DAA6B;IAEjE,MAAM,EAAEC,QAAQ,EAAE,GAAGP;IAErB,MAAMQ,QAAQ,MAAMR,aAAaS,QAAQ;IAEzC,MAAMC,SAAS,MAAML,4BAA4BM,OAAO,CAAC;QACvDC,UAAU,GAAGd,SAAS,CAAC,EAAES,SAASM,KAAK,CAAC,IAAI,CAAC,EAAE,EAAE;QACjDL;QACAV;IACF;IAEA,IAAIY,OAAOI,MAAM,IAAI;QACnB,MAAMV,QAAQM,OAAOK,KAAK;QAC1B,OAAOlB,MAAMK,IAAI,CAACE,MAAMY,UAAU,EAAEb,IAAI,CAAC;YAAEc,SAASb,MAAMa,OAAO;QAAC;IACpE;IAEA,OAAOpB,MAAMK,IAAI,CAAC,KAAKC,IAAI,CAAC;QAC1Bc,SAAS;IACX;AACF"}