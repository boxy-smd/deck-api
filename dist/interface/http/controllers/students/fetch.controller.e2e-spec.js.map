{"version":3,"sources":["../../../../../src/interface/http/controllers/students/fetch.controller.e2e-spec.ts"],"sourcesContent":["import request from 'supertest'\n\nimport { app } from '@/app'\nimport { Email } from '@/domain/authentication/enterprise/value-objects/email'\nimport { Username } from '@/domain/authentication/enterprise/value-objects/username'\nimport { PrismaStudentsRepository } from '@/infra/database/prisma/repositories/students-repository'\nimport { makeUser } from 'test/factories/make-user'\n\ndescribe('fetch students controller (e2e)', () => {\n  beforeAll(async () => {\n    await app.ready()\n  })\n\n  afterAll(async () => {\n    await app.close()\n  })\n\n  it('should be able to fetch students', async () => {\n    const studentsRepository = new PrismaStudentsRepository()\n\n    const student = await makeUser()\n\n    await studentsRepository.create(student)\n\n    const response = await request(app.server).get('/students')\n\n    expect(response.status).toBe(200)\n    expect(response.body).toMatchObject({\n      students: [\n        {\n          id: student.id.toString(),\n          name: student.name,\n          username: student.username.value,\n          semester: student.profile?.semester.value,\n          profileUrl: student.profileUrl,\n          trails: [],\n        },\n      ],\n    })\n  })\n\n  it('should be able to fetch students by name', async () => {\n    const studentsRepository = new PrismaStudentsRepository()\n\n    const amandaUsername = Username.create('amanda.coelho')\n    if (amandaUsername.isLeft()) throw amandaUsername.value\n    const amanda = await makeUser({\n      name: 'Amanda Coelho',\n      username: amandaUsername.value,\n      email: Email.create('amanda@alu.ufc.br'),\n    })\n\n    const leviUsername = Username.create('levi.brito')\n    if (leviUsername.isLeft()) throw leviUsername.value\n    const levi = await makeUser({\n      name: 'Levi de Brito',\n      username: leviUsername.value,\n      email: Email.create('levi@alu.ufc.br'),\n    })\n\n    await studentsRepository.create(amanda)\n    await studentsRepository.create(levi)\n\n    const response = await request(app.server).get('/students').query({\n      name: 'Amanda',\n    })\n\n    expect(response.status).toBe(200)\n    expect(response.body).toMatchObject({\n      students: [\n        {\n          id: amanda.id.toString(),\n          name: amanda.name,\n          username: amanda.username.value,\n          semester: amanda.profile?.semester.value,\n          profileUrl: amanda.profileUrl,\n          trails: [],\n        },\n      ],\n    })\n  })\n})\n"],"names":["describe","beforeAll","app","ready","afterAll","close","it","studentsRepository","PrismaStudentsRepository","student","makeUser","create","response","request","server","get","expect","status","toBe","body","toMatchObject","students","id","toString","name","username","value","semester","profile","profileUrl","trails","amandaUsername","Username","isLeft","amanda","email","Email","leviUsername","levi","query"],"mappings":";;;;kEAAoB;qBAEA;uBACE;0BACG;oCACgB;0BAChB;;;;;;AAEzBA,SAAS,mCAAmC;IAC1CC,UAAU;QACR,MAAMC,QAAG,CAACC,KAAK;IACjB;IAEAC,SAAS;QACP,MAAMF,QAAG,CAACG,KAAK;IACjB;IAEAC,GAAG,oCAAoC;QACrC,MAAMC,qBAAqB,IAAIC,4CAAwB;QAEvD,MAAMC,UAAU,MAAMC,IAAAA,kBAAQ;QAE9B,MAAMH,mBAAmBI,MAAM,CAACF;QAEhC,MAAMG,WAAW,MAAMC,IAAAA,kBAAO,EAACX,QAAG,CAACY,MAAM,EAAEC,GAAG,CAAC;QAE/CC,OAAOJ,SAASK,MAAM,EAAEC,IAAI,CAAC;QAC7BF,OAAOJ,SAASO,IAAI,EAAEC,aAAa,CAAC;YAClCC,UAAU;gBACR;oBACEC,IAAIb,QAAQa,EAAE,CAACC,QAAQ;oBACvBC,MAAMf,QAAQe,IAAI;oBAClBC,UAAUhB,QAAQgB,QAAQ,CAACC,KAAK;oBAChCC,UAAUlB,QAAQmB,OAAO,EAAED,SAASD;oBACpCG,YAAYpB,QAAQoB,UAAU;oBAC9BC,QAAQ,EAAE;gBACZ;aACD;QACH;IACF;IAEAxB,GAAG,4CAA4C;QAC7C,MAAMC,qBAAqB,IAAIC,4CAAwB;QAEvD,MAAMuB,iBAAiBC,kBAAQ,CAACrB,MAAM,CAAC;QACvC,IAAIoB,eAAeE,MAAM,IAAI,MAAMF,eAAeL,KAAK;QACvD,MAAMQ,SAAS,MAAMxB,IAAAA,kBAAQ,EAAC;YAC5Bc,MAAM;YACNC,UAAUM,eAAeL,KAAK;YAC9BS,OAAOC,YAAK,CAACzB,MAAM,CAAC;QACtB;QAEA,MAAM0B,eAAeL,kBAAQ,CAACrB,MAAM,CAAC;QACrC,IAAI0B,aAAaJ,MAAM,IAAI,MAAMI,aAAaX,KAAK;QACnD,MAAMY,OAAO,MAAM5B,IAAAA,kBAAQ,EAAC;YAC1Bc,MAAM;YACNC,UAAUY,aAAaX,KAAK;YAC5BS,OAAOC,YAAK,CAACzB,MAAM,CAAC;QACtB;QAEA,MAAMJ,mBAAmBI,MAAM,CAACuB;QAChC,MAAM3B,mBAAmBI,MAAM,CAAC2B;QAEhC,MAAM1B,WAAW,MAAMC,IAAAA,kBAAO,EAACX,QAAG,CAACY,MAAM,EAAEC,GAAG,CAAC,aAAawB,KAAK,CAAC;YAChEf,MAAM;QACR;QAEAR,OAAOJ,SAASK,MAAM,EAAEC,IAAI,CAAC;QAC7BF,OAAOJ,SAASO,IAAI,EAAEC,aAAa,CAAC;YAClCC,UAAU;gBACR;oBACEC,IAAIY,OAAOZ,EAAE,CAACC,QAAQ;oBACtBC,MAAMU,OAAOV,IAAI;oBACjBC,UAAUS,OAAOT,QAAQ,CAACC,KAAK;oBAC/BC,UAAUO,OAAON,OAAO,EAAED,SAASD;oBACnCG,YAAYK,OAAOL,UAAU;oBAC7BC,QAAQ,EAAE;gBACZ;aACD;QACH;IACF;AACF"}