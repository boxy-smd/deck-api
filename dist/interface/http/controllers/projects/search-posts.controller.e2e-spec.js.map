{"version":3,"sources":["../../../../../src/interface/http/controllers/projects/search-posts.controller.e2e-spec.ts"],"sourcesContent":["import request from 'supertest'\n\nimport { app } from '@/app'\nimport type { User } from '@/domain/authentication/enterprise/entities/user'\nimport type { Professor } from '@/domain/projects/enterprise/entities/professor'\nimport type { Project } from '@/domain/projects/enterprise/entities/project'\nimport type { Subject } from '@/domain/projects/enterprise/entities/subject'\nimport type { Trail } from '@/domain/projects/enterprise/entities/trail'\nimport { ProjectStatus } from '@/domain/projects/enterprise/value-objects/project-status'\nimport { PrismaProfessorsRepository } from '@/infra/database/prisma/repositories/professors-repository'\nimport { PrismaProjectsRepository } from '@/infra/database/prisma/repositories/projects-repository'\nimport { PrismaStudentsRepository } from '@/infra/database/prisma/repositories/students-repository'\nimport { PrismaSubjectsRepository } from '@/infra/database/prisma/repositories/subjects-repository'\nimport { PrismaTrailsRepository } from '@/infra/database/prisma/repositories/trails-repository'\nimport { makeProfessor } from 'test/factories/make-professor'\nimport { makeProject } from 'test/factories/make-project'\nimport { makeSubject } from 'test/factories/make-subject'\nimport { makeTrail } from 'test/factories/make-trail'\nimport { makeUser } from 'test/factories/make-user'\n\nlet author: User\nlet subject: Subject\nlet trail: Trail\nlet professor: Professor\nlet project: Project\n\ndescribe('search posts (e2e)', () => {\n  beforeAll(async () => {\n    await app.ready()\n\n    const projectsRepository = new PrismaProjectsRepository()\n    const studentsRepository = new PrismaStudentsRepository(\n      projectsRepository,\n    )\n    const trailsRepository = new PrismaTrailsRepository()\n    const professorsRepository = new PrismaProfessorsRepository()\n    const subjectsRepository = new PrismaSubjectsRepository()\n\n    author = await makeUser()\n    trail = makeTrail()\n    subject = makeSubject()\n    professor = makeProfessor()\n    project = makeProject({\n      status: ProjectStatus.PUBLISHED,\n      authorId: author.id,\n      subjectId: subject.id,\n      professors: new Set([professor.id]),\n      trails: new Set([trail.id]),\n    })\n\n    await studentsRepository.create(author)\n    await trailsRepository.create(trail)\n    await subjectsRepository.create(subject)\n    await professorsRepository.create(professor)\n    await projectsRepository.create(project)\n  })\n\n  afterAll(async () => {\n    await app.close()\n  })\n\n  it('should be able to search posts by title', async () => {\n    const result = await request(app.server).get('/projects/search').query({\n      title: project.title,\n    })\n\n    expect(result.status).toBe(200)\n    expect(result.body.posts).length(1)\n  })\n\n  it('should be able to search posts by professor name', async () => {\n    const result = await request(app.server).get('/projects/search').query({\n      professorName: professor.name,\n    })\n\n    expect(result.status).toBe(200)\n    expect(result.body.posts).length(1)\n  })\n\n  it('should be able to search posts by subject name', async () => {\n    const result = await request(app.server).get('/projects/search').query({\n      tag: subject.name.toLowerCase(),\n    })\n\n    expect(result.status).toBe(200)\n    expect(result.body.posts).length(1)\n  })\n\n  it('should be able to search posts by trail name', async () => {\n    const result = await request(app.server).get('/projects/search').query({\n      tag: trail.name.toLowerCase(),\n    })\n\n    expect(result.status).toBe(200)\n    expect(result.body.posts).length(1)\n  })\n\n  it('should be able to search posts by publish year', async () => {\n    const result = await request(app.server).get('/projects/search').query({\n      tag: project.publishedYear,\n    })\n\n    expect(result.status).toBe(200)\n    expect(result.body.posts).length(1)\n  })\n\n  it('should be able to search posts by semester (unit)', async () => {\n    const result = await request(app.server).get('/projects/search').query({\n      tag: project.semester,\n    })\n\n    expect(result.status).toBe(200)\n    expect(result.body.posts).length(1)\n  })\n\n  it('should be able to search posts by semester (ordinal)', async () => {\n    const result = await request(app.server).get('/projects/search').query({\n      tag: project.semester,\n    })\n\n    expect(result.status).toBe(200)\n    expect(result.body.posts).length(1)\n  })\n\n  it('should be able to search posts by semester (word)', async () => {\n    const result = await request(app.server).get('/projects/search').query({\n      tag: 'primeiro',\n    })\n\n    expect(result.status).toBe(200)\n    expect(result.body.posts).length(1)\n  })\n})\n"],"names":["author","subject","trail","professor","project","describe","beforeAll","app","ready","projectsRepository","PrismaProjectsRepository","studentsRepository","PrismaStudentsRepository","trailsRepository","PrismaTrailsRepository","professorsRepository","PrismaProfessorsRepository","subjectsRepository","PrismaSubjectsRepository","makeUser","makeTrail","makeSubject","makeProfessor","makeProject","status","ProjectStatus","PUBLISHED","authorId","id","subjectId","professors","Set","trails","create","afterAll","close","it","result","request","server","get","query","title","expect","toBe","body","posts","length","professorName","name","tag","toLowerCase","publishedYear","semester"],"mappings":"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"}