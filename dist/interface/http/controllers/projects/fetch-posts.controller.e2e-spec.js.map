{"version":3,"sources":["../../../../../src/interface/http/controllers/projects/fetch-posts.controller.e2e-spec.ts"],"sourcesContent":["import request from 'supertest'\n\nimport { app } from '@/app'\nimport { ProjectStatus } from '@/domain/projects/enterprise/value-objects/project-status'\nimport { PrismaProjectsRepository } from '@/infra/database/prisma/repositories/projects-repository'\nimport { PrismaStudentsRepository } from '@/infra/database/prisma/repositories/students-repository'\nimport { PrismaSubjectsRepository } from '@/infra/database/prisma/repositories/subjects-repository'\nimport { PrismaTrailsRepository } from '@/infra/database/prisma/repositories/trails-repository'\nimport { makeProject } from 'test/factories/make-project'\nimport { makeSubject } from 'test/factories/make-subject'\nimport { makeTrail } from 'test/factories/make-trail'\nimport { makeUser } from 'test/factories/make-user'\n\ndescribe('fetch posts (e2e)', () => {\n  beforeAll(async () => {\n    await app.ready()\n  })\n\n  afterAll(async () => {\n    await app.close()\n  })\n\n  it('should be able to fetch posts', async () => {\n    const projectsRepository = new PrismaProjectsRepository()\n    const studentsRepository = new PrismaStudentsRepository(\n      projectsRepository,\n    )\n    const trailsRepository = new PrismaTrailsRepository()\n    const subjectsRepository = new PrismaSubjectsRepository()\n\n    const author = await makeUser()\n    const trail = makeTrail()\n    const subject = makeSubject()\n    const project = makeProject({\n      status: ProjectStatus.PUBLISHED,\n      authorId: author.id,\n      subjectId: subject.id,\n      trails: new Set([trail.id]),\n    })\n\n    await studentsRepository.create(author)\n    await trailsRepository.create(trail)\n    await subjectsRepository.create(subject)\n    await projectsRepository.create(project)\n\n    const result = await request(app.server).get('/projects')\n\n    expect(result.status).toBe(200)\n    expect(result.body).toEqual({\n      posts: [\n        {\n          id: project.id.toString(),\n          title: project.title,\n          description: project.description,\n          bannerUrl: project.bannerUrl,\n          content: project.content,\n          publishedYear: project.publishedYear,\n          status: project.status,\n          semester: project.semester,\n          createdAt: expect.any(String),\n          updatedAt: expect.any(String),\n          authorId: project.authorId.toString(),\n          author: {\n            name: author.name,\n            username: author.username.value,\n            profileUrl: author.profileUrl,\n          },\n          subjectId: project.subjectId?.toString(),\n          subject: {\n            name: subject.name,\n          },\n          trails: [\n            {\n              name: trail.name,\n            },\n          ],\n          professors: [],\n        },\n      ],\n    })\n  })\n})\n"],"names":["describe","beforeAll","app","ready","afterAll","close","it","projectsRepository","PrismaProjectsRepository","studentsRepository","PrismaStudentsRepository","trailsRepository","PrismaTrailsRepository","subjectsRepository","PrismaSubjectsRepository","author","makeUser","trail","makeTrail","subject","makeSubject","project","makeProject","status","ProjectStatus","PUBLISHED","authorId","id","subjectId","trails","Set","create","result","request","server","get","expect","toBe","body","toEqual","posts","toString","title","description","bannerUrl","content","publishedYear","semester","createdAt","any","String","updatedAt","name","username","value","profileUrl","professors"],"mappings":";;;;kEAAoB;qBAEA;+BACU;oCACW;oCACA;oCACA;kCACF;6BACX;6BACA;2BACF;0BACD;;;;;;AAEzBA,SAAS,qBAAqB;IAC5BC,UAAU;QACR,MAAMC,QAAG,CAACC,KAAK;IACjB;IAEAC,SAAS;QACP,MAAMF,QAAG,CAACG,KAAK;IACjB;IAEAC,GAAG,iCAAiC;QAClC,MAAMC,qBAAqB,IAAIC,4CAAwB;QACvD,MAAMC,qBAAqB,IAAIC,4CAAwB,CACrDH;QAEF,MAAMI,mBAAmB,IAAIC,wCAAsB;QACnD,MAAMC,qBAAqB,IAAIC,4CAAwB;QAEvD,MAAMC,SAAS,MAAMC,IAAAA,kBAAQ;QAC7B,MAAMC,QAAQC,IAAAA,oBAAS;QACvB,MAAMC,UAAUC,IAAAA,wBAAW;QAC3B,MAAMC,UAAUC,IAAAA,wBAAW,EAAC;YAC1BC,QAAQC,4BAAa,CAACC,SAAS;YAC/BC,UAAUX,OAAOY,EAAE;YACnBC,WAAWT,QAAQQ,EAAE;YACrBE,QAAQ,IAAIC,IAAI;gBAACb,MAAMU,EAAE;aAAC;QAC5B;QAEA,MAAMlB,mBAAmBsB,MAAM,CAAChB;QAChC,MAAMJ,iBAAiBoB,MAAM,CAACd;QAC9B,MAAMJ,mBAAmBkB,MAAM,CAACZ;QAChC,MAAMZ,mBAAmBwB,MAAM,CAACV;QAEhC,MAAMW,SAAS,MAAMC,IAAAA,kBAAO,EAAC/B,QAAG,CAACgC,MAAM,EAAEC,GAAG,CAAC;QAE7CC,OAAOJ,OAAOT,MAAM,EAAEc,IAAI,CAAC;QAC3BD,OAAOJ,OAAOM,IAAI,EAAEC,OAAO,CAAC;YAC1BC,OAAO;gBACL;oBACEb,IAAIN,QAAQM,EAAE,CAACc,QAAQ;oBACvBC,OAAOrB,QAAQqB,KAAK;oBACpBC,aAAatB,QAAQsB,WAAW;oBAChCC,WAAWvB,QAAQuB,SAAS;oBAC5BC,SAASxB,QAAQwB,OAAO;oBACxBC,eAAezB,QAAQyB,aAAa;oBACpCvB,QAAQF,QAAQE,MAAM;oBACtBwB,UAAU1B,QAAQ0B,QAAQ;oBAC1BC,WAAWZ,OAAOa,GAAG,CAACC;oBACtBC,WAAWf,OAAOa,GAAG,CAACC;oBACtBxB,UAAUL,QAAQK,QAAQ,CAACe,QAAQ;oBACnC1B,QAAQ;wBACNqC,MAAMrC,OAAOqC,IAAI;wBACjBC,UAAUtC,OAAOsC,QAAQ,CAACC,KAAK;wBAC/BC,YAAYxC,OAAOwC,UAAU;oBAC/B;oBACA3B,WAAWP,QAAQO,SAAS,EAAEa;oBAC9BtB,SAAS;wBACPiC,MAAMjC,QAAQiC,IAAI;oBACpB;oBACAvB,QAAQ;wBACN;4BACEuB,MAAMnC,MAAMmC,IAAI;wBAClB;qBACD;oBACDI,YAAY,EAAE;gBAChB;aACD;QACH;IACF;AACF"}