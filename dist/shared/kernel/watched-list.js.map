{"version":3,"sources":["../../../src/shared/kernel/watched-list.ts"],"sourcesContent":["export abstract class WatchedList<T> {\n  public currentItems: T[]\n  private initial: T[]\n  private new: T[]\n  private removed: T[]\n\n  constructor(initialItems?: T[]) {\n    this.currentItems = initialItems || []\n    this.initial = initialItems || []\n    this.new = []\n    this.removed = []\n  }\n\n  abstract compareItems(a: T, b: T): boolean\n\n  public getItems(): T[] {\n    return this.currentItems\n  }\n\n  public getNewItems(): T[] {\n    return this.new\n  }\n\n  public getRemovedItems(): T[] {\n    return this.removed\n  }\n\n  private isCurrentItem(item: T): boolean {\n    return (\n      this.currentItems.filter((v: T) => this.compareItems(item, v)).length !==\n      0\n    )\n  }\n\n  private isNewItem(item: T): boolean {\n    return this.new.filter((v: T) => this.compareItems(item, v)).length !== 0\n  }\n\n  private isRemovedItem(item: T): boolean {\n    return (\n      this.removed.filter((v: T) => this.compareItems(item, v)).length !== 0\n    )\n  }\n\n  private removeFromNew(item: T): void {\n    this.new = this.new.filter(v => !this.compareItems(v, item))\n  }\n\n  private removeFromCurrent(item: T): void {\n    this.currentItems = this.currentItems.filter(\n      v => !this.compareItems(item, v),\n    )\n  }\n\n  private removeFromRemoved(item: T): void {\n    this.removed = this.removed.filter(v => !this.compareItems(item, v))\n  }\n\n  private wasAddedInitially(item: T): boolean {\n    return (\n      this.initial.filter((v: T) => this.compareItems(item, v)).length !== 0\n    )\n  }\n\n  public exists(item: T): boolean {\n    return this.isCurrentItem(item)\n  }\n\n  public add(item: T): void {\n    if (this.isRemovedItem(item)) {\n      this.removeFromRemoved(item)\n    }\n\n    if (!(this.isNewItem(item) || this.wasAddedInitially(item))) {\n      this.new.push(item)\n    }\n\n    if (!this.isCurrentItem(item)) {\n      this.currentItems.push(item)\n    }\n  }\n\n  public remove(item: T): void {\n    this.removeFromCurrent(item)\n\n    if (this.isNewItem(item)) {\n      this.removeFromNew(item)\n\n      return\n    }\n\n    if (!this.isRemovedItem(item)) {\n      this.removed.push(item)\n    }\n  }\n\n  public update(items: T[]): void {\n    const newItems = items.filter(a => {\n      return !this.getItems().some(b => this.compareItems(a, b))\n    })\n\n    const removedItems = this.getItems().filter(a => {\n      return !items.some(b => this.compareItems(a, b))\n    })\n\n    this.currentItems = items\n    this.new = newItems\n    this.removed = removedItems\n  }\n}\n"],"names":["WatchedList","getItems","currentItems","getNewItems","new","getRemovedItems","removed","isCurrentItem","item","filter","v","compareItems","length","isNewItem","isRemovedItem","removeFromNew","removeFromCurrent","removeFromRemoved","wasAddedInitially","initial","exists","add","push","remove","update","items","newItems","a","some","b","removedItems","initialItems"],"mappings":";;;;+BAAsBA;;;eAAAA;;;AAAf,IAAA,AAAeA,cAAf,MAAeA;IAebC,WAAgB;QACrB,OAAO,IAAI,CAACC,YAAY;IAC1B;IAEOC,cAAmB;QACxB,OAAO,IAAI,CAACC,GAAG;IACjB;IAEOC,kBAAuB;QAC5B,OAAO,IAAI,CAACC,OAAO;IACrB;IAEQC,cAAcC,IAAO,EAAW;QACtC,OACE,IAAI,CAACN,YAAY,CAACO,MAAM,CAAC,CAACC,IAAS,IAAI,CAACC,YAAY,CAACH,MAAME,IAAIE,MAAM,KACrE;IAEJ;IAEQC,UAAUL,IAAO,EAAW;QAClC,OAAO,IAAI,CAACJ,GAAG,CAACK,MAAM,CAAC,CAACC,IAAS,IAAI,CAACC,YAAY,CAACH,MAAME,IAAIE,MAAM,KAAK;IAC1E;IAEQE,cAAcN,IAAO,EAAW;QACtC,OACE,IAAI,CAACF,OAAO,CAACG,MAAM,CAAC,CAACC,IAAS,IAAI,CAACC,YAAY,CAACH,MAAME,IAAIE,MAAM,KAAK;IAEzE;IAEQG,cAAcP,IAAO,EAAQ;QACnC,IAAI,CAACJ,GAAG,GAAG,IAAI,CAACA,GAAG,CAACK,MAAM,CAACC,CAAAA,IAAK,CAAC,IAAI,CAACC,YAAY,CAACD,GAAGF;IACxD;IAEQQ,kBAAkBR,IAAO,EAAQ;QACvC,IAAI,CAACN,YAAY,GAAG,IAAI,CAACA,YAAY,CAACO,MAAM,CAC1CC,CAAAA,IAAK,CAAC,IAAI,CAACC,YAAY,CAACH,MAAME;IAElC;IAEQO,kBAAkBT,IAAO,EAAQ;QACvC,IAAI,CAACF,OAAO,GAAG,IAAI,CAACA,OAAO,CAACG,MAAM,CAACC,CAAAA,IAAK,CAAC,IAAI,CAACC,YAAY,CAACH,MAAME;IACnE;IAEQQ,kBAAkBV,IAAO,EAAW;QAC1C,OACE,IAAI,CAACW,OAAO,CAACV,MAAM,CAAC,CAACC,IAAS,IAAI,CAACC,YAAY,CAACH,MAAME,IAAIE,MAAM,KAAK;IAEzE;IAEOQ,OAAOZ,IAAO,EAAW;QAC9B,OAAO,IAAI,CAACD,aAAa,CAACC;IAC5B;IAEOa,IAAIb,IAAO,EAAQ;QACxB,IAAI,IAAI,CAACM,aAAa,CAACN,OAAO;YAC5B,IAAI,CAACS,iBAAiB,CAACT;QACzB;QAEA,IAAI,CAAE,CAAA,IAAI,CAACK,SAAS,CAACL,SAAS,IAAI,CAACU,iBAAiB,CAACV,KAAI,GAAI;YAC3D,IAAI,CAACJ,GAAG,CAACkB,IAAI,CAACd;QAChB;QAEA,IAAI,CAAC,IAAI,CAACD,aAAa,CAACC,OAAO;YAC7B,IAAI,CAACN,YAAY,CAACoB,IAAI,CAACd;QACzB;IACF;IAEOe,OAAOf,IAAO,EAAQ;QAC3B,IAAI,CAACQ,iBAAiB,CAACR;QAEvB,IAAI,IAAI,CAACK,SAAS,CAACL,OAAO;YACxB,IAAI,CAACO,aAAa,CAACP;YAEnB;QACF;QAEA,IAAI,CAAC,IAAI,CAACM,aAAa,CAACN,OAAO;YAC7B,IAAI,CAACF,OAAO,CAACgB,IAAI,CAACd;QACpB;IACF;IAEOgB,OAAOC,KAAU,EAAQ;QAC9B,MAAMC,WAAWD,MAAMhB,MAAM,CAACkB,CAAAA;YAC5B,OAAO,CAAC,IAAI,CAAC1B,QAAQ,GAAG2B,IAAI,CAACC,CAAAA,IAAK,IAAI,CAAClB,YAAY,CAACgB,GAAGE;QACzD;QAEA,MAAMC,eAAe,IAAI,CAAC7B,QAAQ,GAAGQ,MAAM,CAACkB,CAAAA;YAC1C,OAAO,CAACF,MAAMG,IAAI,CAACC,CAAAA,IAAK,IAAI,CAAClB,YAAY,CAACgB,GAAGE;QAC/C;QAEA,IAAI,CAAC3B,YAAY,GAAGuB;QACpB,IAAI,CAACrB,GAAG,GAAGsB;QACX,IAAI,CAACpB,OAAO,GAAGwB;IACjB;IAtGA,YAAYC,YAAkB,CAAE;QAC9B,IAAI,CAAC7B,YAAY,GAAG6B,gBAAgB,EAAE;QACtC,IAAI,CAACZ,OAAO,GAAGY,gBAAgB,EAAE;QACjC,IAAI,CAAC3B,GAAG,GAAG,EAAE;QACb,IAAI,CAACE,OAAO,GAAG,EAAE;IACnB;AAkGF"}