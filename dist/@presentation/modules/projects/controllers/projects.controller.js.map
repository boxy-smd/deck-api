{"version":3,"sources":["../../../../../src/@presentation/modules/projects/controllers/projects.controller.ts"],"sourcesContent":["import { makeDeleteProjectUseCase } from '@/@core/application/factories/projects/make-delete-project-use-case'\nimport { makeGetProjectUseCase } from '@/@core/application/factories/projects/make-get-project-use-case'\nimport { makePublishProjectUseCase } from '@/@core/application/factories/projects/make-publish-project-use-case'\nimport { makeSearchProjectsUseCase } from '@/@core/application/factories/projects/make-search-projects-use-case'\nimport { makeUploadProjectBannerUseCase } from '@/@core/application/factories/projects/make-upload-project-banner-use-case'\nimport { JwtAuthGuard } from '@/@presentation/modules/auth/guards/jwt-auth.guard'\nimport { ProjectDetailsPresenter } from '@/@presentation/presenters/project-details'\nimport {\n  BadRequestException,\n  Body,\n  ConflictException,\n  Controller,\n  Delete,\n  ForbiddenException,\n  Get,\n  HttpCode,\n  HttpStatus,\n  NotFoundException,\n  Param,\n  Post,\n  Query,\n  Request,\n  UploadedFile,\n  UseGuards,\n  UseInterceptors,\n} from '@nestjs/common'\nimport { FileInterceptor } from '@nestjs/platform-express'\nimport {\n  ApiBearerAuth,\n  ApiBody,\n  ApiConsumes,\n  ApiOperation,\n  ApiResponse,\n  ApiTags,\n} from '@nestjs/swagger'\nimport type { FetchPostsDto, FilterPostsDto } from '../dto/fetch-posts.dto'\nimport type { PublishProjectDto } from '../dto/publish-project.dto'\n\n@ApiTags('Projects')\n@Controller()\nexport class ProjectsController {\n  @Post('projects')\n  @UseGuards(JwtAuthGuard)\n  @ApiBearerAuth()\n  @ApiOperation({ summary: 'Publish a project' })\n  @ApiResponse({ status: 201, description: 'Project published successfully' })\n  @ApiResponse({ status: 400, description: 'Bad request' })\n  @ApiResponse({ status: 404, description: 'Resource not found' })\n  async publishProject(@Body() dto: PublishProjectDto, @Request() req: any) {\n    const publishProjectUseCase = makePublishProjectUseCase()\n\n    const result = await publishProjectUseCase.execute({\n      title: dto.title,\n      description: dto.description,\n      bannerUrl: dto.bannerUrl,\n      content: dto.content,\n      publishedYear: dto.publishedYear,\n      semester: dto.semester,\n      allowComments: dto.allowComments,\n      authorId: req.user.userId,\n      subjectId: dto.subjectId,\n      trailsIds: dto.trailsIds,\n      professorsIds: dto.professorsIds,\n      draftId: dto.draftId,\n    })\n\n    if (result.isLeft()) {\n      const error = result.value\n      if (error.statusCode === 404) {\n        throw new NotFoundException(error.message)\n      }\n      if (error.statusCode === 409) {\n        throw new ConflictException(error.message)\n      }\n      throw new BadRequestException(error.message)\n    }\n\n    return {\n      project_id: result.value.projectId,\n    }\n  }\n\n  @Get('posts')\n  @ApiOperation({ summary: 'Fetch posts' })\n  @ApiResponse({ status: 200, description: 'Posts retrieved successfully' })\n  async fetchPosts(@Query() query: FetchPostsDto) {\n    const searchProjectsUseCase = makeSearchProjectsUseCase()\n\n    const result = await searchProjectsUseCase.execute({})\n\n    if (result.isLeft()) {\n      throw new BadRequestException('Failed to fetch posts')\n    }\n\n    return {\n      posts: result.value.items,\n      pagination: {\n        page: result.value.page,\n        perPage: result.value.perPage,\n        total: result.value.total,\n        totalPages: result.value.totalPages,\n      },\n    }\n  }\n\n  @Get('posts/search')\n  @ApiOperation({ summary: 'Search/Filter posts' })\n  @ApiResponse({ status: 200, description: 'Posts retrieved successfully' })\n  async filterPosts(@Query() filter: FilterPostsDto) {\n    const searchProjectsUseCase = makeSearchProjectsUseCase()\n\n    const result = await searchProjectsUseCase.execute({\n      title: filter.title,\n      professorName: filter.professorName,\n      tags: filter.tags,\n      subjectId: filter.subjectId,\n      trailsIds: filter.trailsIds,\n      semester: filter.semester,\n      publishedYear: filter.publishedYear,\n    })\n\n    if (result.isLeft()) {\n      throw new BadRequestException('Failed to search projects')\n    }\n\n    return {\n      posts: result.value.items,\n      pagination: {\n        page: result.value.page,\n        perPage: result.value.perPage,\n        total: result.value.total,\n        totalPages: result.value.totalPages,\n      },\n    }\n  }\n\n  @Get('projects/:projectId')\n  @ApiOperation({ summary: 'Get project details' })\n  @ApiResponse({ status: 200, description: 'Project retrieved successfully' })\n  @ApiResponse({ status: 404, description: 'Project not found' })\n  async getProject(@Param('projectId') projectId: string) {\n    const getProjectUseCase = makeGetProjectUseCase()\n\n    const result = await getProjectUseCase.execute({ projectId })\n\n    if (result.isLeft()) {\n      const error = result.value\n      if (error.statusCode === 404) {\n        throw new NotFoundException(error.message)\n      }\n      throw new BadRequestException(error.message)\n    }\n\n    return ProjectDetailsPresenter.toHTTP(result.value)\n  }\n\n  @Delete('projects/:projectId')\n  @UseGuards(JwtAuthGuard)\n  @ApiBearerAuth()\n  @HttpCode(HttpStatus.NO_CONTENT)\n  @ApiOperation({ summary: 'Delete a project' })\n  @ApiResponse({ status: 204, description: 'Project deleted successfully' })\n  @ApiResponse({ status: 403, description: 'Forbidden' })\n  @ApiResponse({ status: 404, description: 'Project not found' })\n  async deleteProject(\n    @Param('projectId') projectId: string,\n    @Request() req: any,\n  ) {\n    const deleteProjectUseCase = makeDeleteProjectUseCase()\n\n    const result = await deleteProjectUseCase.execute({\n      projectId,\n      studentId: req.user.userId,\n    })\n\n    if (result.isLeft()) {\n      const error = result.value\n      if (error.statusCode === 404) {\n        throw new NotFoundException(error.message)\n      }\n      if (error.statusCode === 403) {\n        throw new ForbiddenException(error.message)\n      }\n      throw new BadRequestException(error.message)\n    }\n  }\n\n  @Post('projects/:projectId/banner')\n  @UseGuards(JwtAuthGuard)\n  @UseInterceptors(FileInterceptor('file'))\n  @ApiBearerAuth()\n  @ApiConsumes('multipart/form-data')\n  @ApiOperation({ summary: 'Upload project banner' })\n  @ApiBody({\n    schema: {\n      type: 'object',\n      properties: {\n        file: {\n          type: 'string',\n          format: 'binary',\n        },\n      },\n    },\n  })\n  @ApiResponse({ status: 200, description: 'Banner uploaded successfully' })\n  @ApiResponse({ status: 404, description: 'Project not found' })\n  async uploadBanner(\n    @Param('projectId') projectId: string,\n    @UploadedFile() file: Express.Multer.File,\n  ) {\n    if (!file) {\n      throw new BadRequestException('File is required')\n    }\n\n    const uploadUseCase = makeUploadProjectBannerUseCase()\n\n    const result = await uploadUseCase.execute({\n      projectId,\n      filename: file.originalname,\n      image: file.buffer,\n    })\n\n    if (result.isLeft()) {\n      const error = result.value\n      if (error.statusCode === 404) {\n        throw new NotFoundException(error.message)\n      }\n      throw new BadRequestException(error.message)\n    }\n\n    return { message: 'Banner uploaded successfully' }\n  }\n}\n"],"names":["ProjectsController","publishProject","dto","req","publishProjectUseCase","makePublishProjectUseCase","result","execute","title","description","bannerUrl","content","publishedYear","semester","allowComments","authorId","user","userId","subjectId","trailsIds","professorsIds","draftId","isLeft","error","value","statusCode","NotFoundException","message","ConflictException","BadRequestException","project_id","projectId","fetchPosts","query","searchProjectsUseCase","makeSearchProjectsUseCase","posts","items","pagination","page","perPage","total","totalPages","filterPosts","filter","professorName","tags","getProject","getProjectUseCase","makeGetProjectUseCase","ProjectDetailsPresenter","toHTTP","deleteProject","deleteProjectUseCase","makeDeleteProjectUseCase","studentId","ForbiddenException","uploadBanner","file","uploadUseCase","makeUploadProjectBannerUseCase","filename","originalname","image","buffer","summary","status","NO_CONTENT","schema","type","properties","format"],"mappings":"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"}