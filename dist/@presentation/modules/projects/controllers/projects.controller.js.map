{"version":3,"sources":["../../../../../src/@presentation/modules/projects/controllers/projects.controller.ts"],"sourcesContent":["import { makeDeleteProjectUseCase } from '@/@core/application/factories/projects/make-delete-project-use-case'\r\nimport { makeGetProjectUseCase } from '@/@core/application/factories/projects/make-get-project-use-case'\r\nimport { makePublishProjectUseCase } from '@/@core/application/factories/projects/make-publish-project-use-case'\r\nimport { makeSearchProjectsUseCase } from '@/@core/application/factories/projects/make-search-projects-use-case'\r\nimport { makeUploadProjectBannerUseCase } from '@/@core/application/factories/projects/make-upload-project-banner-use-case'\r\nimport { ProjectDetailsPresenter } from '@/@presentation/presenters/project-details'\r\nimport { JwtAuthGuard } from '@/@presentation/modules/auth/guards/jwt-auth.guard'\r\nimport {\r\n  BadRequestException,\r\n  Body,\r\n  ConflictException,\r\n  Controller,\r\n  Delete,\r\n  ForbiddenException,\r\n  Get,\r\n  HttpCode,\r\n  HttpStatus,\r\n  NotFoundException,\r\n  Param,\r\n  Post,\r\n  Query,\r\n  Request,\r\n  UploadedFile,\r\n  UseGuards,\r\n  UseInterceptors,\r\n} from '@nestjs/common'\r\nimport { FileInterceptor } from '@nestjs/platform-express'\r\nimport {\r\n  ApiBearerAuth,\r\n  ApiBody,\r\n  ApiConsumes,\r\n  ApiOperation,\r\n  ApiResponse,\r\n  ApiTags,\r\n} from '@nestjs/swagger'\r\nimport type { FetchPostsDto, FilterPostsDto } from '../dto/fetch-posts.dto'\r\nimport type { PublishProjectDto } from '../dto/publish-project.dto'\r\n\r\n@ApiTags('Projects')\r\n@Controller()\r\nexport class ProjectsController {\r\n  @Post('projects')\r\n  @UseGuards(JwtAuthGuard)\r\n  @ApiBearerAuth()\r\n  @ApiOperation({ summary: 'Publish a project' })\r\n  @ApiResponse({ status: 201, description: 'Project published successfully' })\r\n  @ApiResponse({ status: 400, description: 'Bad request' })\r\n  @ApiResponse({ status: 404, description: 'Resource not found' })\r\n  async publishProject(@Body() dto: PublishProjectDto, @Request() req: any) {\r\n    const publishProjectUseCase = makePublishProjectUseCase()\r\n\r\n    const result = await publishProjectUseCase.execute({\r\n      title: dto.title,\r\n      description: dto.description,\r\n      bannerUrl: dto.bannerUrl,\r\n      content: dto.content,\r\n      publishedYear: dto.publishedYear,\r\n      semester: dto.semester,\r\n      allowComments: dto.allowComments,\r\n      authorId: req.user.userId,\r\n      subjectId: dto.subjectId,\r\n      trailsIds: dto.trailsIds,\r\n      professorsIds: dto.professorsIds,\r\n      draftId: dto.draftId,\r\n    })\r\n\r\n    if (result.isLeft()) {\r\n      const error = result.value\r\n      if (error.statusCode === 404) {\r\n        throw new NotFoundException(error.message)\r\n      }\r\n      if (error.statusCode === 409) {\r\n        throw new ConflictException(error.message)\r\n      }\r\n      throw new BadRequestException(error.message)\r\n    }\r\n\r\n    return {\r\n      project_id: result.value.projectId,\r\n    }\r\n  }\r\n\r\n  @Get('posts')\r\n  @ApiOperation({ summary: 'Fetch posts' })\r\n  @ApiResponse({ status: 200, description: 'Posts retrieved successfully' })\r\n  async fetchPosts(@Query() query: FetchPostsDto) {\r\n    const searchProjectsUseCase = makeSearchProjectsUseCase()\r\n\r\n    const result = await searchProjectsUseCase.execute({})\r\n\r\n    if (result.isLeft()) {\r\n      throw new BadRequestException('Failed to fetch posts')\r\n    }\r\n\r\n    return {\r\n      posts: result.value.items,\r\n      pagination: {\r\n        page: result.value.page,\r\n        perPage: result.value.perPage,\r\n        total: result.value.total,\r\n        totalPages: result.value.totalPages,\r\n      },\r\n    }\r\n  }\r\n\r\n  @Get('posts/search')\r\n  @ApiOperation({ summary: 'Search/Filter posts' })\r\n  @ApiResponse({ status: 200, description: 'Posts retrieved successfully' })\r\n  async filterPosts(@Query() filter: FilterPostsDto) {\r\n    const searchProjectsUseCase = makeSearchProjectsUseCase()\r\n\r\n    const result = await searchProjectsUseCase.execute({\r\n      title: filter.title,\r\n      professorName: filter.professorName,\r\n      tags: filter.tags,\r\n      subjectId: filter.subjectId,\r\n      trailsIds: filter.trailsIds,\r\n      semester: filter.semester,\r\n      publishedYear: filter.publishedYear,\r\n    })\r\n\r\n    if (result.isLeft()) {\r\n      throw new BadRequestException('Failed to search projects')\r\n    }\r\n\r\n    return {\r\n      posts: result.value.items,\r\n      pagination: {\r\n        page: result.value.page,\r\n        perPage: result.value.perPage,\r\n        total: result.value.total,\r\n        totalPages: result.value.totalPages,\r\n      },\r\n    }\r\n  }\r\n\r\n  @Get('projects/:projectId')\r\n  @ApiOperation({ summary: 'Get project details' })\r\n  @ApiResponse({ status: 200, description: 'Project retrieved successfully' })\r\n  @ApiResponse({ status: 404, description: 'Project not found' })\r\n  async getProject(@Param('projectId') projectId: string) {\r\n    const getProjectUseCase = makeGetProjectUseCase()\r\n\r\n    const result = await getProjectUseCase.execute({ projectId })\r\n\r\n    if (result.isLeft()) {\r\n      const error = result.value\r\n      if (error.statusCode === 404) {\r\n        throw new NotFoundException(error.message)\r\n      }\r\n      throw new BadRequestException(error.message)\r\n    }\r\n\r\n    return ProjectDetailsPresenter.toHTTP(result.value)\r\n  }\r\n\r\n  @Delete('projects/:projectId')\r\n  @UseGuards(JwtAuthGuard)\r\n  @ApiBearerAuth()\r\n  @HttpCode(HttpStatus.NO_CONTENT)\r\n  @ApiOperation({ summary: 'Delete a project' })\r\n  @ApiResponse({ status: 204, description: 'Project deleted successfully' })\r\n  @ApiResponse({ status: 403, description: 'Forbidden' })\r\n  @ApiResponse({ status: 404, description: 'Project not found' })\r\n  async deleteProject(\r\n    @Param('projectId') projectId: string,\r\n    @Request() req: any,\r\n  ) {\r\n    const deleteProjectUseCase = makeDeleteProjectUseCase()\r\n\r\n    const result = await deleteProjectUseCase.execute({\r\n      projectId,\r\n      studentId: req.user.userId,\r\n    })\r\n\r\n    if (result.isLeft()) {\r\n      const error = result.value\r\n      if (error.statusCode === 404) {\r\n        throw new NotFoundException(error.message)\r\n      }\r\n      if (error.statusCode === 403) {\r\n        throw new ForbiddenException(error.message)\r\n      }\r\n      throw new BadRequestException(error.message)\r\n    }\r\n  }\r\n\r\n  @Post('projects/:projectId/banner')\r\n  @UseGuards(JwtAuthGuard)\r\n  @UseInterceptors(FileInterceptor('file'))\r\n  @ApiBearerAuth()\r\n  @ApiConsumes('multipart/form-data')\r\n  @ApiOperation({ summary: 'Upload project banner' })\r\n  @ApiBody({\r\n    schema: {\r\n      type: 'object',\r\n      properties: {\r\n        file: {\r\n          type: 'string',\r\n          format: 'binary',\r\n        },\r\n      },\r\n    },\r\n  })\r\n  @ApiResponse({ status: 200, description: 'Banner uploaded successfully' })\r\n  @ApiResponse({ status: 404, description: 'Project not found' })\r\n  async uploadBanner(\r\n    @Param('projectId') projectId: string,\r\n    @UploadedFile() file: Express.Multer.File,\r\n  ) {\r\n    if (!file) {\r\n      throw new BadRequestException('File is required')\r\n    }\r\n\r\n    const uploadUseCase = makeUploadProjectBannerUseCase()\r\n\r\n    const result = await uploadUseCase.execute({\r\n      projectId,\r\n      filename: file.originalname,\r\n      image: file.buffer,\r\n    })\r\n\r\n    if (result.isLeft()) {\r\n      const error = result.value\r\n      if (error.statusCode === 404) {\r\n        throw new NotFoundException(error.message)\r\n      }\r\n      throw new BadRequestException(error.message)\r\n    }\r\n\r\n    return { message: 'Banner uploaded successfully' }\r\n  }\r\n}\r\n"],"names":["ProjectsController","publishProject","dto","req","publishProjectUseCase","makePublishProjectUseCase","result","execute","title","description","bannerUrl","content","publishedYear","semester","allowComments","authorId","user","userId","subjectId","trailsIds","professorsIds","draftId","isLeft","error","value","statusCode","NotFoundException","message","ConflictException","BadRequestException","project_id","projectId","fetchPosts","query","searchProjectsUseCase","makeSearchProjectsUseCase","posts","items","pagination","page","perPage","total","totalPages","filterPosts","filter","professorName","tags","getProject","getProjectUseCase","makeGetProjectUseCase","ProjectDetailsPresenter","toHTTP","deleteProject","deleteProjectUseCase","makeDeleteProjectUseCase","studentId","ForbiddenException","uploadBanner","file","uploadUseCase","makeUploadProjectBannerUseCase","filename","originalname","image","buffer","summary","status","NO_CONTENT","schema","type","properties","format"],"mappings":"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"}