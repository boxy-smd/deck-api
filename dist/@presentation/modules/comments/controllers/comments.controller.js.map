{"version":3,"sources":["../../../../../src/@presentation/modules/comments/controllers/comments.controller.ts"],"sourcesContent":["import { makeCommentOnProjectUseCase } from '@/@core/application/factories/comments/make-comment-on-project-use-case'\r\nimport { makeDeleteCommentUseCase } from '@/@core/application/factories/comments/make-delete-comment-use-case'\r\nimport { makeListProjectCommentsUseCase } from '@/@core/application/factories/comments/make-list-project-comments-use-case'\r\nimport { makeReportCommentUseCase } from '@/@core/application/factories/comments/make-report-comment-use-case'\r\nimport { CommentPresenter } from '@/@presentation/presenters/comment'\r\nimport { JwtAuthGuard } from '@/@presentation/modules/auth/guards/jwt-auth.guard'\r\nimport {\r\n  BadRequestException,\r\n  Body,\r\n  Controller,\r\n  Delete,\r\n  ForbiddenException,\r\n  Get,\r\n  HttpCode,\r\n  HttpStatus,\r\n  NotFoundException,\r\n  Param,\r\n  Post,\r\n  Request,\r\n  UseGuards,\r\n} from '@nestjs/common'\r\nimport {\r\n  ApiBearerAuth,\r\n  ApiOperation,\r\n  ApiResponse,\r\n  ApiTags,\r\n} from '@nestjs/swagger'\r\nimport type { CommentOnProjectDto } from '../dto/comment-on-project.dto'\r\nimport type { ReportCommentDto } from '../dto/report-comment.dto'\r\n\r\n@ApiTags('Comments')\r\n@Controller()\r\nexport class CommentsController {\r\n  @Get('projects/:projectId/comments')\r\n  @ApiOperation({ summary: 'List project comments' })\r\n  @ApiResponse({ status: 200, description: 'Comments retrieved successfully' })\r\n  @ApiResponse({ status: 404, description: 'Project not found' })\r\n  async listProjectComments(@Param('projectId') projectId: string) {\r\n    const listProjectCommentsUseCase = makeListProjectCommentsUseCase()\r\n\r\n    const result = await listProjectCommentsUseCase.execute({ projectId })\r\n\r\n    if (result.isLeft()) {\r\n      const error = result.value\r\n      if (error.statusCode === 404) {\r\n        throw new NotFoundException(error.message)\r\n      }\r\n      throw new BadRequestException(error.message)\r\n    }\r\n\r\n    return {\r\n      comments: result.value.comments.map(CommentPresenter.toHTTP),\r\n    }\r\n  }\r\n\r\n  @Post('projects/:projectId/comments')\r\n  @UseGuards(JwtAuthGuard)\r\n  @ApiBearerAuth()\r\n  @ApiOperation({ summary: 'Comment on a project' })\r\n  @ApiResponse({ status: 201, description: 'Comment created successfully' })\r\n  @ApiResponse({ status: 404, description: 'Project not found' })\r\n  async commentOnProject(\r\n    @Param('projectId') projectId: string,\r\n    @Body() dto: CommentOnProjectDto,\r\n    @Request() req: any,\r\n  ) {\r\n    const commentOnProjectUseCase = makeCommentOnProjectUseCase()\r\n\r\n    const result = await commentOnProjectUseCase.execute({\r\n      projectId,\r\n      content: dto.content,\r\n      authorId: req.user.userId,\r\n    })\r\n\r\n    if (result.isLeft()) {\r\n      const error = result.value\r\n      if (error.statusCode === 404) {\r\n        throw new NotFoundException(error.message)\r\n      }\r\n      if (error.statusCode === 403) {\r\n        throw new ForbiddenException(error.message)\r\n      }\r\n      throw new BadRequestException(error.message)\r\n    }\r\n\r\n    return {\r\n      comment_id: result.value.commentId,\r\n    }\r\n  }\r\n\r\n  @Delete('projects/:projectId/comments/:commentId')\r\n  @UseGuards(JwtAuthGuard)\r\n  @ApiBearerAuth()\r\n  @HttpCode(HttpStatus.NO_CONTENT)\r\n  @ApiOperation({ summary: 'Delete a comment' })\r\n  @ApiResponse({ status: 204, description: 'Comment deleted successfully' })\r\n  @ApiResponse({ status: 403, description: 'Forbidden' })\r\n  @ApiResponse({ status: 404, description: 'Comment not found' })\r\n  async deleteComment(\r\n    @Param('projectId') projectId: string,\r\n    @Param('commentId') commentId: string,\r\n    @Request() req: any,\r\n  ) {\r\n    const deleteCommentUseCase = makeDeleteCommentUseCase()\r\n\r\n    const result = await deleteCommentUseCase.execute({\r\n      authorId: req.user.userId,\r\n      commentId,\r\n      projectId,\r\n    })\r\n\r\n    if (result.isLeft()) {\r\n      const error = result.value\r\n      if (error.statusCode === 404) {\r\n        throw new NotFoundException(error.message)\r\n      }\r\n      if (error.statusCode === 403) {\r\n        throw new ForbiddenException(error.message)\r\n      }\r\n      throw new BadRequestException(error.message)\r\n    }\r\n  }\r\n\r\n  @Post('comments/:commentId/report')\r\n  @UseGuards(JwtAuthGuard)\r\n  @ApiBearerAuth()\r\n  @ApiOperation({ summary: 'Report a comment' })\r\n  @ApiResponse({ status: 201, description: 'Comment reported successfully' })\r\n  @ApiResponse({ status: 404, description: 'Comment not found' })\r\n  async reportComment(\r\n    @Param('commentId') commentId: string,\r\n    @Body() dto: ReportCommentDto,\r\n    @Request() req: any,\r\n  ) {\r\n    const reportCommentUseCase = makeReportCommentUseCase()\r\n\r\n    const result = await reportCommentUseCase.execute({\r\n      authorId: req.user.userId,\r\n      commentId,\r\n      projectId: dto.projectId,\r\n      content: dto.content,\r\n    })\r\n\r\n    if (result.isLeft()) {\r\n      const error = result.value\r\n      if (error.statusCode === 404) {\r\n        throw new NotFoundException(error.message)\r\n      }\r\n      throw new BadRequestException(error.message)\r\n    }\r\n\r\n    return {\r\n      message: 'Comment reported successfully.',\r\n    }\r\n  }\r\n}\r\n"],"names":["CommentsController","listProjectComments","projectId","listProjectCommentsUseCase","makeListProjectCommentsUseCase","result","execute","isLeft","error","value","statusCode","NotFoundException","message","BadRequestException","comments","map","CommentPresenter","toHTTP","commentOnProject","dto","req","commentOnProjectUseCase","makeCommentOnProjectUseCase","content","authorId","user","userId","ForbiddenException","comment_id","commentId","deleteComment","deleteCommentUseCase","makeDeleteCommentUseCase","reportComment","reportCommentUseCase","makeReportCommentUseCase","summary","status","description","NO_CONTENT"],"mappings":"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"}