{"version":3,"sources":["../../../../../src/@presentation/modules/comments/controllers/comments.controller.ts"],"sourcesContent":["import { makeCommentOnProjectUseCase } from '@/@core/application/factories/comments/make-comment-on-project-use-case'\nimport { makeDeleteCommentUseCase } from '@/@core/application/factories/comments/make-delete-comment-use-case'\nimport { makeListProjectCommentsUseCase } from '@/@core/application/factories/comments/make-list-project-comments-use-case'\nimport { makeReportCommentUseCase } from '@/@core/application/factories/comments/make-report-comment-use-case'\nimport { JwtAuthGuard } from '@/@presentation/modules/auth/guards/jwt-auth.guard'\nimport { CommentPresenter } from '@/@presentation/presenters/comment'\nimport {\n  BadRequestException,\n  Body,\n  Controller,\n  Delete,\n  ForbiddenException,\n  Get,\n  HttpCode,\n  HttpStatus,\n  NotFoundException,\n  Param,\n  Post,\n  Request,\n  UseGuards,\n} from '@nestjs/common'\nimport {\n  ApiBearerAuth,\n  ApiOperation,\n  ApiResponse,\n  ApiTags,\n} from '@nestjs/swagger'\nimport type { CommentOnProjectDto } from '../dto/comment-on-project.dto'\nimport type { ReportCommentDto } from '../dto/report-comment.dto'\n\n@ApiTags('Comments')\n@Controller()\nexport class CommentsController {\n  @Get('projects/:projectId/comments')\n  @ApiOperation({ summary: 'List project comments' })\n  @ApiResponse({ status: 200, description: 'Comments retrieved successfully' })\n  @ApiResponse({ status: 404, description: 'Project not found' })\n  async listProjectComments(@Param('projectId') projectId: string) {\n    const listProjectCommentsUseCase = makeListProjectCommentsUseCase()\n\n    const result = await listProjectCommentsUseCase.execute({ projectId })\n\n    if (result.isLeft()) {\n      const error = result.value\n      if (error.statusCode === 404) {\n        throw new NotFoundException(error.message)\n      }\n      throw new BadRequestException(error.message)\n    }\n\n    return {\n      comments: result.value.comments.map(CommentPresenter.toHTTP),\n    }\n  }\n\n  @Post('projects/:projectId/comments')\n  @UseGuards(JwtAuthGuard)\n  @ApiBearerAuth()\n  @ApiOperation({ summary: 'Comment on a project' })\n  @ApiResponse({ status: 201, description: 'Comment created successfully' })\n  @ApiResponse({ status: 404, description: 'Project not found' })\n  async commentOnProject(\n    @Param('projectId') projectId: string,\n    @Body() dto: CommentOnProjectDto,\n    @Request() req: any,\n  ) {\n    const commentOnProjectUseCase = makeCommentOnProjectUseCase()\n\n    const result = await commentOnProjectUseCase.execute({\n      projectId,\n      content: dto.content,\n      authorId: req.user.userId,\n    })\n\n    if (result.isLeft()) {\n      const error = result.value\n      if (error.statusCode === 404) {\n        throw new NotFoundException(error.message)\n      }\n      if (error.statusCode === 403) {\n        throw new ForbiddenException(error.message)\n      }\n      throw new BadRequestException(error.message)\n    }\n\n    return {\n      comment_id: result.value.commentId,\n    }\n  }\n\n  @Delete('projects/:projectId/comments/:commentId')\n  @UseGuards(JwtAuthGuard)\n  @ApiBearerAuth()\n  @HttpCode(HttpStatus.NO_CONTENT)\n  @ApiOperation({ summary: 'Delete a comment' })\n  @ApiResponse({ status: 204, description: 'Comment deleted successfully' })\n  @ApiResponse({ status: 403, description: 'Forbidden' })\n  @ApiResponse({ status: 404, description: 'Comment not found' })\n  async deleteComment(\n    @Param('projectId') projectId: string,\n    @Param('commentId') commentId: string,\n    @Request() req: any,\n  ) {\n    const deleteCommentUseCase = makeDeleteCommentUseCase()\n\n    const result = await deleteCommentUseCase.execute({\n      authorId: req.user.userId,\n      commentId,\n      projectId,\n    })\n\n    if (result.isLeft()) {\n      const error = result.value\n      if (error.statusCode === 404) {\n        throw new NotFoundException(error.message)\n      }\n      if (error.statusCode === 403) {\n        throw new ForbiddenException(error.message)\n      }\n      throw new BadRequestException(error.message)\n    }\n  }\n\n  @Post('comments/:commentId/report')\n  @UseGuards(JwtAuthGuard)\n  @ApiBearerAuth()\n  @ApiOperation({ summary: 'Report a comment' })\n  @ApiResponse({ status: 201, description: 'Comment reported successfully' })\n  @ApiResponse({ status: 404, description: 'Comment not found' })\n  async reportComment(\n    @Param('commentId') commentId: string,\n    @Body() dto: ReportCommentDto,\n    @Request() req: any,\n  ) {\n    const reportCommentUseCase = makeReportCommentUseCase()\n\n    const result = await reportCommentUseCase.execute({\n      authorId: req.user.userId,\n      commentId,\n      projectId: dto.projectId,\n      content: dto.content,\n    })\n\n    if (result.isLeft()) {\n      const error = result.value\n      if (error.statusCode === 404) {\n        throw new NotFoundException(error.message)\n      }\n      throw new BadRequestException(error.message)\n    }\n\n    return {\n      message: 'Comment reported successfully.',\n    }\n  }\n}\n"],"names":["CommentsController","listProjectComments","projectId","listProjectCommentsUseCase","makeListProjectCommentsUseCase","result","execute","isLeft","error","value","statusCode","NotFoundException","message","BadRequestException","comments","map","CommentPresenter","toHTTP","commentOnProject","dto","req","commentOnProjectUseCase","makeCommentOnProjectUseCase","content","authorId","user","userId","ForbiddenException","comment_id","commentId","deleteComment","deleteCommentUseCase","makeDeleteCommentUseCase","reportComment","reportCommentUseCase","makeReportCommentUseCase","summary","status","description","NO_CONTENT"],"mappings":";;;;+BAgCaA;;;eAAAA;;;6CAhC+B;0CACH;gDACM;0CACN;8BACZ;yBACI;wBAe1B;yBAMA;;;;;;;;;;;;;;;AAMA,IAAA,AAAMA,qBAAN,MAAMA;IACX,MAIMC,oBAAoB,AAAoBC,SAAiB,EAAE;QAC/D,MAAMC,6BAA6BC,IAAAA,8DAA8B;QAEjE,MAAMC,SAAS,MAAMF,2BAA2BG,OAAO,CAAC;YAAEJ;QAAU;QAEpE,IAAIG,OAAOE,MAAM,IAAI;YACnB,MAAMC,QAAQH,OAAOI,KAAK;YAC1B,IAAID,MAAME,UAAU,KAAK,KAAK;gBAC5B,MAAM,IAAIC,yBAAiB,CAACH,MAAMI,OAAO;YAC3C;YACA,MAAM,IAAIC,2BAAmB,CAACL,MAAMI,OAAO;QAC7C;QAEA,OAAO;YACLE,UAAUT,OAAOI,KAAK,CAACK,QAAQ,CAACC,GAAG,CAACC,yBAAgB,CAACC,MAAM;QAC7D;IACF;IAEA,MAMMC,iBACJ,AAAoBhB,SAAiB,EACrC,AAAQiB,GAAwB,EAChC,AAAWC,GAAQ,EACnB;QACA,MAAMC,0BAA0BC,IAAAA,wDAA2B;QAE3D,MAAMjB,SAAS,MAAMgB,wBAAwBf,OAAO,CAAC;YACnDJ;YACAqB,SAASJ,IAAII,OAAO;YACpBC,UAAUJ,IAAIK,IAAI,CAACC,MAAM;QAC3B;QAEA,IAAIrB,OAAOE,MAAM,IAAI;YACnB,MAAMC,QAAQH,OAAOI,KAAK;YAC1B,IAAID,MAAME,UAAU,KAAK,KAAK;gBAC5B,MAAM,IAAIC,yBAAiB,CAACH,MAAMI,OAAO;YAC3C;YACA,IAAIJ,MAAME,UAAU,KAAK,KAAK;gBAC5B,MAAM,IAAIiB,0BAAkB,CAACnB,MAAMI,OAAO;YAC5C;YACA,MAAM,IAAIC,2BAAmB,CAACL,MAAMI,OAAO;QAC7C;QAEA,OAAO;YACLgB,YAAYvB,OAAOI,KAAK,CAACoB,SAAS;QACpC;IACF;IAEA,MAQMC,cACJ,AAAoB5B,SAAiB,EACrC,AAAoB2B,SAAiB,EACrC,AAAWT,GAAQ,EACnB;QACA,MAAMW,uBAAuBC,IAAAA,kDAAwB;QAErD,MAAM3B,SAAS,MAAM0B,qBAAqBzB,OAAO,CAAC;YAChDkB,UAAUJ,IAAIK,IAAI,CAACC,MAAM;YACzBG;YACA3B;QACF;QAEA,IAAIG,OAAOE,MAAM,IAAI;YACnB,MAAMC,QAAQH,OAAOI,KAAK;YAC1B,IAAID,MAAME,UAAU,KAAK,KAAK;gBAC5B,MAAM,IAAIC,yBAAiB,CAACH,MAAMI,OAAO;YAC3C;YACA,IAAIJ,MAAME,UAAU,KAAK,KAAK;gBAC5B,MAAM,IAAIiB,0BAAkB,CAACnB,MAAMI,OAAO;YAC5C;YACA,MAAM,IAAIC,2BAAmB,CAACL,MAAMI,OAAO;QAC7C;IACF;IAEA,MAMMqB,cACJ,AAAoBJ,SAAiB,EACrC,AAAQV,GAAqB,EAC7B,AAAWC,GAAQ,EACnB;QACA,MAAMc,uBAAuBC,IAAAA,kDAAwB;QAErD,MAAM9B,SAAS,MAAM6B,qBAAqB5B,OAAO,CAAC;YAChDkB,UAAUJ,IAAIK,IAAI,CAACC,MAAM;YACzBG;YACA3B,WAAWiB,IAAIjB,SAAS;YACxBqB,SAASJ,IAAII,OAAO;QACtB;QAEA,IAAIlB,OAAOE,MAAM,IAAI;YACnB,MAAMC,QAAQH,OAAOI,KAAK;YAC1B,IAAID,MAAME,UAAU,KAAK,KAAK;gBAC5B,MAAM,IAAIC,yBAAiB,CAACH,MAAMI,OAAO;YAC3C;YACA,MAAM,IAAIC,2BAAmB,CAACL,MAAMI,OAAO;QAC7C;QAEA,OAAO;YACLA,SAAS;QACX;IACF;AACF;;;;QAzHkBwB,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;QAC1BD,QAAQ;QAAKC,aAAa;;;;;;;;;;;;;;QAsBzBF,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;QAC1BD,QAAQ;QAAKC,aAAa;;;;;;;;;;;;;;;;;6CAiCpBC;;QACLH,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;QAC1BD,QAAQ;QAAKC,aAAa;;;QAC1BD,QAAQ;QAAKC,aAAa;;;;;;;;;;;;;;;;;;QA6BzBF,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;QAC1BD,QAAQ;QAAKC,aAAa"}