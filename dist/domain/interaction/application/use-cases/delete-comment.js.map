{"version":3,"sources":["../../../../../src/domain/interaction/application/use-cases/delete-comment.ts"],"sourcesContent":["import type { UsersRepository } from '@/domain/authentication/application/repositories/users-repository'\nimport type { CommentsRepository } from '@/domain/interaction/application/repositories/comments-repository'\nimport { type Either, left, right } from '@/shared/either'\nimport { ForbiddenError } from '@/shared/errors/forbidden.error'\nimport { ResourceNotFoundError } from '@/shared/errors/resource-not-found.error'\n\ninterface DeleteCommentUseCaseRequest {\n  authorId: string\n  projectId: string\n  commentId: string\n}\n\ntype DeleteCommentUseCaseResponse = Either<\n  ForbiddenError | ResourceNotFoundError,\n  void\n>\n\nexport class DeleteCommentUseCase {\n  constructor(\n    private readonly commentsRepository: CommentsRepository,\n    private readonly usersRepository: UsersRepository,\n  ) {}\n\n  async execute({\n    authorId,\n    projectId,\n    commentId,\n  }: DeleteCommentUseCaseRequest): Promise<DeleteCommentUseCaseResponse> {\n    if (!authorId) {\n      return left(\n        new ForbiddenError(\n          'Você deve estar logado para deletar um comentário.',\n        ),\n      )\n    }\n\n    const author = await this.usersRepository.findById(authorId)\n\n    if (!author) {\n      return left(new ResourceNotFoundError('Autor não encontrado.'))\n    }\n\n    const comment = await this.commentsRepository.findById(commentId)\n\n    if (!comment) {\n      return left(new ResourceNotFoundError('Comentário não encontrado.'))\n    }\n\n    if (comment.projectId.toString() !== projectId) {\n      return left(new ResourceNotFoundError('Comentário não encontrado neste projeto.'))\n    }\n\n    if (comment.authorId.toString() !== authorId) {\n      return left(\n        new ForbiddenError(\n          'Você não tem permissão para deletar este comentário.',\n        ),\n      )\n    }\n\n    await this.commentsRepository.delete(comment)\n\n    return right(undefined)\n  }\n}\n"],"names":["DeleteCommentUseCase","execute","authorId","projectId","commentId","left","ForbiddenError","author","usersRepository","findById","ResourceNotFoundError","comment","commentsRepository","toString","delete","right","undefined"],"mappings":";;;;+BAiBaA;;;eAAAA;;;wBAf4B;gCACV;uCACO;AAa/B,IAAA,AAAMA,uBAAN,MAAMA;IAMX,MAAMC,QAAQ,EACZC,QAAQ,EACRC,SAAS,EACTC,SAAS,EACmB,EAAyC;QACrE,IAAI,CAACF,UAAU;YACb,OAAOG,IAAAA,YAAI,EACT,IAAIC,8BAAc,CAChB;QAGN;QAEA,MAAMC,SAAS,MAAM,IAAI,CAACC,eAAe,CAACC,QAAQ,CAACP;QAEnD,IAAI,CAACK,QAAQ;YACX,OAAOF,IAAAA,YAAI,EAAC,IAAIK,4CAAqB,CAAC;QACxC;QAEA,MAAMC,UAAU,MAAM,IAAI,CAACC,kBAAkB,CAACH,QAAQ,CAACL;QAEvD,IAAI,CAACO,SAAS;YACZ,OAAON,IAAAA,YAAI,EAAC,IAAIK,4CAAqB,CAAC;QACxC;QAEA,IAAIC,QAAQR,SAAS,CAACU,QAAQ,OAAOV,WAAW;YAC9C,OAAOE,IAAAA,YAAI,EAAC,IAAIK,4CAAqB,CAAC;QACxC;QAEA,IAAIC,QAAQT,QAAQ,CAACW,QAAQ,OAAOX,UAAU;YAC5C,OAAOG,IAAAA,YAAI,EACT,IAAIC,8BAAc,CAChB;QAGN;QAEA,MAAM,IAAI,CAACM,kBAAkB,CAACE,MAAM,CAACH;QAErC,OAAOI,IAAAA,aAAK,EAACC;IACf;IA7CA,YACE,AAAiBJ,kBAAsC,EACvD,AAAiBJ,eAAgC,CACjD;aAFiBI,qBAAAA;aACAJ,kBAAAA;IAChB;AA2CL"}