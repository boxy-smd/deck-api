{"version":3,"sources":["../../../../../src/domain/interaction/application/use-cases/report-comment.ts"],"sourcesContent":["import type { UsersRepository } from '@/domain/authentication/application/repositories/users-repository'\nimport type { CommentsRepository } from '@/domain/interaction/application/repositories/comments-repository'\nimport type { ReportsRepository } from '@/domain/interaction/application/repositories/reports-repository'\nimport { type Either, left, right } from '@/shared/either'\nimport { ForbiddenError } from '@/shared/errors/forbidden.error'\nimport { ResourceNotFoundError } from '@/shared/errors/resource-not-found.error'\nimport { Report } from '../../enterprise/entities/report'\n\ninterface ReportCommentUseCaseRequest {\n  content: string\n  authorId: string\n  projectId: string\n  commentId: string\n}\n\ntype ReportCommentUseCaseResponse = Either<\n  ForbiddenError | ResourceNotFoundError,\n  void\n>\n\nexport class ReportCommentUseCase {\n  constructor(\n    private studentsRepository: UsersRepository,\n    private commentsRepository: CommentsRepository,\n    private reportsRepository: ReportsRepository,\n  ) {}\n\n  async execute({\n    content,\n    authorId,\n    projectId,\n    commentId,\n  }: ReportCommentUseCaseRequest): Promise<ReportCommentUseCaseResponse> {\n    if (!authorId) {\n      return left(\n        new ForbiddenError('You must be logged in to report a comment.'),\n      )\n    }\n\n    const comment = await this.commentsRepository.findById(commentId)\n\n    if (!comment) {\n      return left(new ResourceNotFoundError('Comment not found.'))\n    }\n\n    if (comment.projectId.toString() !== projectId) {\n      return left(new ResourceNotFoundError('Comment not found in this project.'))\n    }\n\n    const student = await this.studentsRepository.findById(authorId)\n\n    if (!student) {\n      return left(new ResourceNotFoundError('Student not found.'))\n    }\n\n    const report = Report.create({\n      content,\n      authorId: student.id,\n      commentId: comment.id,\n      isResolved: false,\n    })\n\n    await this.reportsRepository.create(report)\n\n    return right(undefined)\n  }\n}\n"],"names":["ReportCommentUseCase","execute","content","authorId","projectId","commentId","left","ForbiddenError","comment","commentsRepository","findById","ResourceNotFoundError","toString","student","studentsRepository","report","Report","create","id","isResolved","reportsRepository","right","undefined"],"mappings":";;;;+BAoBaA;;;eAAAA;;;wBAjB4B;gCACV;uCACO;wBACf;AAchB,IAAA,AAAMA,uBAAN,MAAMA;IAOX,MAAMC,QAAQ,EACZC,OAAO,EACPC,QAAQ,EACRC,SAAS,EACTC,SAAS,EACmB,EAAyC;QACrE,IAAI,CAACF,UAAU;YACb,OAAOG,IAAAA,YAAI,EACT,IAAIC,8BAAc,CAAC;QAEvB;QAEA,MAAMC,UAAU,MAAM,IAAI,CAACC,kBAAkB,CAACC,QAAQ,CAACL;QAEvD,IAAI,CAACG,SAAS;YACZ,OAAOF,IAAAA,YAAI,EAAC,IAAIK,4CAAqB,CAAC;QACxC;QAEA,IAAIH,QAAQJ,SAAS,CAACQ,QAAQ,OAAOR,WAAW;YAC9C,OAAOE,IAAAA,YAAI,EAAC,IAAIK,4CAAqB,CAAC;QACxC;QAEA,MAAME,UAAU,MAAM,IAAI,CAACC,kBAAkB,CAACJ,QAAQ,CAACP;QAEvD,IAAI,CAACU,SAAS;YACZ,OAAOP,IAAAA,YAAI,EAAC,IAAIK,4CAAqB,CAAC;QACxC;QAEA,MAAMI,SAASC,cAAM,CAACC,MAAM,CAAC;YAC3Bf;YACAC,UAAUU,QAAQK,EAAE;YACpBb,WAAWG,QAAQU,EAAE;YACrBC,YAAY;QACd;QAEA,MAAM,IAAI,CAACC,iBAAiB,CAACH,MAAM,CAACF;QAEpC,OAAOM,IAAAA,aAAK,EAACC;IACf;IA5CA,YACE,AAAQR,kBAAmC,EAC3C,AAAQL,kBAAsC,EAC9C,AAAQW,iBAAoC,CAC5C;aAHQN,qBAAAA;aACAL,qBAAAA;aACAW,oBAAAA;IACP;AAyCL"}