{"version":3,"sources":["../../../../../src/domain/interaction/application/use-cases/comment-on-project.ts"],"sourcesContent":["import type { UsersRepository } from '@/domain/authentication/application/repositories/users-repository'\nimport type { StudentProfile } from '@/domain/authentication/enterprise/entities/student-profile'\nimport type { CommentsRepository } from '@/domain/interaction/application/repositories/comments-repository'\nimport { type Either, left, right } from '@/shared/either'\nimport { ForbiddenError } from '@/shared/errors/forbidden.error'\nimport { ResourceNotFoundError } from '@/shared/errors/resource-not-found.error'\nimport { UniqueEntityID } from '@/shared/kernel/unique-entity-id'\nimport type { ProjectsRepository } from '../../../projects/application/repositories/projects-repository'\n\ninterface CommentOnProjectUseCaseRequest {\n  content: string\n  authorId: string\n  projectId: string\n}\n\ntype CommentOnProjectUseCaseResponse = Either<\n  ForbiddenError | ResourceNotFoundError,\n  {\n    commentId: string\n  }\n>\n\nexport class CommentOnProjectUseCase {\n  constructor(\n    private readonly projectsRepository: ProjectsRepository,\n    private readonly usersRepository: UsersRepository,\n    private readonly commentsRepository: CommentsRepository,\n  ) {}\n\n  async execute({\n    authorId,\n    projectId,\n    content,\n  }: CommentOnProjectUseCaseRequest): Promise<CommentOnProjectUseCaseResponse> {\n    if (!authorId) {\n      return left(\n        new ForbiddenError(\n          'Você deve estar logado para comentar em um projeto.',\n        ),\n      )\n    }\n\n    const author = await this.usersRepository.findById(authorId)\n\n    if (!author) {\n      return left(new ResourceNotFoundError('Autor não encontrado.'))\n    }\n\n    const project = await this.projectsRepository.findById(projectId)\n\n    if (!project) {\n      return left(new ResourceNotFoundError('Projeto não encontrado.'))\n    }\n\n    const comment = project.comment(\n      content,\n      new UniqueEntityID<StudentProfile>(authorId),\n    )\n\n    await this.commentsRepository.create(comment)\n\n    return right({\n      commentId: comment.id.toString(),\n    })\n  }\n}\n"],"names":["CommentOnProjectUseCase","execute","authorId","projectId","content","left","ForbiddenError","author","usersRepository","findById","ResourceNotFoundError","project","projectsRepository","comment","UniqueEntityID","commentsRepository","create","right","commentId","id","toString"],"mappings":";;;;+BAsBaA;;;eAAAA;;;wBAnB4B;gCACV;uCACO;gCACP;AAgBxB,IAAA,AAAMA,0BAAN,MAAMA;IAOX,MAAMC,QAAQ,EACZC,QAAQ,EACRC,SAAS,EACTC,OAAO,EACwB,EAA4C;QAC3E,IAAI,CAACF,UAAU;YACb,OAAOG,IAAAA,YAAI,EACT,IAAIC,8BAAc,CAChB;QAGN;QAEA,MAAMC,SAAS,MAAM,IAAI,CAACC,eAAe,CAACC,QAAQ,CAACP;QAEnD,IAAI,CAACK,QAAQ;YACX,OAAOF,IAAAA,YAAI,EAAC,IAAIK,4CAAqB,CAAC;QACxC;QAEA,MAAMC,UAAU,MAAM,IAAI,CAACC,kBAAkB,CAACH,QAAQ,CAACN;QAEvD,IAAI,CAACQ,SAAS;YACZ,OAAON,IAAAA,YAAI,EAAC,IAAIK,4CAAqB,CAAC;QACxC;QAEA,MAAMG,UAAUF,QAAQE,OAAO,CAC7BT,SACA,IAAIU,8BAAc,CAAiBZ;QAGrC,MAAM,IAAI,CAACa,kBAAkB,CAACC,MAAM,CAACH;QAErC,OAAOI,IAAAA,aAAK,EAAC;YACXC,WAAWL,QAAQM,EAAE,CAACC,QAAQ;QAChC;IACF;IAzCA,YACE,AAAiBR,kBAAsC,EACvD,AAAiBJ,eAAgC,EACjD,AAAiBO,kBAAsC,CACvD;aAHiBH,qBAAAA;aACAJ,kBAAAA;aACAO,qBAAAA;IAChB;AAsCL"}