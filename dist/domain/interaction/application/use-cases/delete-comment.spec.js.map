{"version":3,"sources":["../../../../../src/domain/interaction/application/use-cases/delete-comment.spec.ts"],"sourcesContent":["import type { UsersRepository } from '@/domain/authentication/application/repositories/users-repository'\nimport type { User } from '@/domain/authentication/enterprise/entities/user'\nimport type { CommentsRepository } from '@/domain/interaction/application/repositories/comments-repository'\nimport type { ProjectsRepository } from '@/domain/projects/application/repositories/projects-repository'\nimport type { TrailsRepository } from '@/domain/projects/application/repositories/trails-repository'\nimport { ForbiddenError } from '@/shared/errors/forbidden.error'\nimport { ResourceNotFoundError } from '@/shared/errors/resource-not-found.error'\nimport { makeProject } from 'test/factories/make-project'\nimport { makeTrail } from 'test/factories/make-trail'\nimport { makeUser } from 'test/factories/make-user'\nimport { InMemoryCommentsRepository } from 'test/repositories/comments-repository'\nimport { InMemoryProjectsRepository } from 'test/repositories/projects-repository'\nimport { InMemoryTrailsRepository } from 'test/repositories/trails-repository'\nimport { InMemoryUsersRepository } from 'test/repositories/users-repository'\nimport type { Comment } from '../../../interaction/enterprise/entities/comment'\nimport type { Project } from '../../../projects/enterprise/entities/project'\nimport { DeleteCommentUseCase } from './delete-comment'\n\nlet usersRepository: UsersRepository\nlet projectsRepository: ProjectsRepository\nlet trailsRepository: TrailsRepository\nlet commentsRepository: CommentsRepository\n\nlet author: User\nlet project: Project\nlet comment: Comment\n\nlet sut: DeleteCommentUseCase\n\ndescribe('delete comment use case', () => {\n  beforeEach(async () => {\n    usersRepository = new InMemoryUsersRepository()\n    trailsRepository = new InMemoryTrailsRepository()\n    projectsRepository = new InMemoryProjectsRepository()\n    commentsRepository = new InMemoryCommentsRepository(usersRepository)\n\n    author = await makeUser()\n    const trail = makeTrail()\n    project = makeProject({\n      authorId: author.id,\n      trails: new Set([trail.id]),\n    })\n    comment = project.comment('ParabÃ©ns pelo projeto!', author.id)\n\n    await usersRepository.create(author)\n    await trailsRepository.create(trail)\n    await projectsRepository.create(project)\n    await commentsRepository.create(comment)\n\n    sut = new DeleteCommentUseCase(commentsRepository, usersRepository)\n  })\n\n  it('should be able to delete a comment', async () => {\n    const response = await sut.execute({\n      projectId: project.id.toString(),\n      authorId: author.id.toString(),\n      commentId: comment.id.toString(),\n    })\n\n    expect(response.isRight()).toBe(true)\n    expect(response.value).toBeUndefined()\n  })\n\n  it('should not be able to delete a comment if the author is not logged in', async () => {\n    const response = await sut.execute({\n      projectId: project.id.toString(),\n      authorId: '',\n      commentId: comment.id.toString(),\n    })\n\n    expect(response.isLeft()).toBe(true)\n    expect(response.value).toBeInstanceOf(ForbiddenError)\n  })\n\n  it('should not be able to delete a comment if the author does not exist', async () => {\n    const response = await sut.execute({\n      projectId: project.id.toString(),\n      authorId: 'invalid-author-id',\n      commentId: comment.id.toString(),\n    })\n\n    expect(response.isLeft()).toBe(true)\n    expect(response.value).toBeInstanceOf(ResourceNotFoundError)\n  })\n\n  it('should not be able to delete a comment if the comment does not exist', async () => {\n    const response = await sut.execute({\n      projectId: project.id.toString(),\n      authorId: author.id.toString(),\n      commentId: 'invalid-comment-id',\n    })\n\n    expect(response.isLeft()).toBe(true)\n    expect(response.value).toBeInstanceOf(ResourceNotFoundError)\n  })\n\n  it('should not be able to delete a comment if the project does not exist', async () => {\n    await projectsRepository.deleteById(project.id.toString())\n\n    const response = await sut.execute({\n      projectId: 'invalid-project-id',\n      authorId: author.id.toString(),\n      commentId: comment.id.toString(),\n    })\n\n    expect(response.isLeft()).toBe(true)\n    expect(response.value).toBeInstanceOf(ResourceNotFoundError)\n  })\n})\n"],"names":["usersRepository","projectsRepository","trailsRepository","commentsRepository","author","project","comment","sut","describe","beforeEach","InMemoryUsersRepository","InMemoryTrailsRepository","InMemoryProjectsRepository","InMemoryCommentsRepository","makeUser","trail","makeTrail","makeProject","authorId","id","trails","Set","create","DeleteCommentUseCase","it","response","execute","projectId","toString","commentId","expect","isRight","toBe","value","toBeUndefined","isLeft","toBeInstanceOf","ForbiddenError","ResourceNotFoundError","deleteById"],"mappings":";;;;gCAK+B;uCACO;6BACV;2BACF;0BACD;oCACkB;oCACA;kCACF;iCACD;+BAGH;AAErC,IAAIA;AACJ,IAAIC;AACJ,IAAIC;AACJ,IAAIC;AAEJ,IAAIC;AACJ,IAAIC;AACJ,IAAIC;AAEJ,IAAIC;AAEJC,SAAS,2BAA2B;IAClCC,WAAW;QACTT,kBAAkB,IAAIU,wCAAuB;QAC7CR,mBAAmB,IAAIS,0CAAwB;QAC/CV,qBAAqB,IAAIW,8CAA0B;QACnDT,qBAAqB,IAAIU,8CAA0B,CAACb;QAEpDI,SAAS,MAAMU,IAAAA,kBAAQ;QACvB,MAAMC,QAAQC,IAAAA,oBAAS;QACvBX,UAAUY,IAAAA,wBAAW,EAAC;YACpBC,UAAUd,OAAOe,EAAE;YACnBC,QAAQ,IAAIC,IAAI;gBAACN,MAAMI,EAAE;aAAC;QAC5B;QACAb,UAAUD,QAAQC,OAAO,CAAC,0BAA0BF,OAAOe,EAAE;QAE7D,MAAMnB,gBAAgBsB,MAAM,CAAClB;QAC7B,MAAMF,iBAAiBoB,MAAM,CAACP;QAC9B,MAAMd,mBAAmBqB,MAAM,CAACjB;QAChC,MAAMF,mBAAmBmB,MAAM,CAAChB;QAEhCC,MAAM,IAAIgB,mCAAoB,CAACpB,oBAAoBH;IACrD;IAEAwB,GAAG,sCAAsC;QACvC,MAAMC,WAAW,MAAMlB,IAAImB,OAAO,CAAC;YACjCC,WAAWtB,QAAQc,EAAE,CAACS,QAAQ;YAC9BV,UAAUd,OAAOe,EAAE,CAACS,QAAQ;YAC5BC,WAAWvB,QAAQa,EAAE,CAACS,QAAQ;QAChC;QAEAE,OAAOL,SAASM,OAAO,IAAIC,IAAI,CAAC;QAChCF,OAAOL,SAASQ,KAAK,EAAEC,aAAa;IACtC;IAEAV,GAAG,yEAAyE;QAC1E,MAAMC,WAAW,MAAMlB,IAAImB,OAAO,CAAC;YACjCC,WAAWtB,QAAQc,EAAE,CAACS,QAAQ;YAC9BV,UAAU;YACVW,WAAWvB,QAAQa,EAAE,CAACS,QAAQ;QAChC;QAEAE,OAAOL,SAASU,MAAM,IAAIH,IAAI,CAAC;QAC/BF,OAAOL,SAASQ,KAAK,EAAEG,cAAc,CAACC,8BAAc;IACtD;IAEAb,GAAG,uEAAuE;QACxE,MAAMC,WAAW,MAAMlB,IAAImB,OAAO,CAAC;YACjCC,WAAWtB,QAAQc,EAAE,CAACS,QAAQ;YAC9BV,UAAU;YACVW,WAAWvB,QAAQa,EAAE,CAACS,QAAQ;QAChC;QAEAE,OAAOL,SAASU,MAAM,IAAIH,IAAI,CAAC;QAC/BF,OAAOL,SAASQ,KAAK,EAAEG,cAAc,CAACE,4CAAqB;IAC7D;IAEAd,GAAG,wEAAwE;QACzE,MAAMC,WAAW,MAAMlB,IAAImB,OAAO,CAAC;YACjCC,WAAWtB,QAAQc,EAAE,CAACS,QAAQ;YAC9BV,UAAUd,OAAOe,EAAE,CAACS,QAAQ;YAC5BC,WAAW;QACb;QAEAC,OAAOL,SAASU,MAAM,IAAIH,IAAI,CAAC;QAC/BF,OAAOL,SAASQ,KAAK,EAAEG,cAAc,CAACE,4CAAqB;IAC7D;IAEAd,GAAG,wEAAwE;QACzE,MAAMvB,mBAAmBsC,UAAU,CAAClC,QAAQc,EAAE,CAACS,QAAQ;QAEvD,MAAMH,WAAW,MAAMlB,IAAImB,OAAO,CAAC;YACjCC,WAAW;YACXT,UAAUd,OAAOe,EAAE,CAACS,QAAQ;YAC5BC,WAAWvB,QAAQa,EAAE,CAACS,QAAQ;QAChC;QAEAE,OAAOL,SAASU,MAAM,IAAIH,IAAI,CAAC;QAC/BF,OAAOL,SAASQ,KAAK,EAAEG,cAAc,CAACE,4CAAqB;IAC7D;AACF"}