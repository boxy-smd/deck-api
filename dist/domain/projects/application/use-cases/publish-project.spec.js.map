{"version":3,"sources":["../../../../../src/domain/projects/application/use-cases/publish-project.spec.ts"],"sourcesContent":["import type { UsersRepository } from '@/domain/authentication/application/repositories/users-repository'\nimport type { User } from '@/domain/authentication/enterprise/entities/user'\nimport type { ProfessorsRepository } from '@/domain/projects/application/repositories/professors-repository'\nimport type { ProjectsRepository } from '@/domain/projects/application/repositories/projects-repository'\nimport type { SubjectsRepository } from '@/domain/projects/application/repositories/subjects-repository'\nimport type { TrailsRepository } from '@/domain/projects/application/repositories/trails-repository'\nimport type { Trail } from '@/domain/projects/enterprise/entities/trail'\nimport { ResourceNotFoundError } from '@/shared/errors/resource-not-found.error'\nimport { makeProfessor } from 'test/factories/make-professor'\nimport { makeSubject } from 'test/factories/make-subject'\nimport { makeTrail } from 'test/factories/make-trail'\nimport { makeUser } from 'test/factories/make-user'\nimport { InMemoryProfessorsRepository } from 'test/repositories/professors-repository'\nimport { InMemoryProjectsRepository } from 'test/repositories/projects-repository'\nimport { InMemorySubjectsRepository } from 'test/repositories/subjects-repository'\nimport { InMemoryTrailsRepository } from 'test/repositories/trails-repository'\nimport { InMemoryUsersRepository } from 'test/repositories/users-repository'\nimport { PublishProjectUseCase } from './publish-project'\n\nlet projectsRepository: ProjectsRepository\nlet studentsRepository: UsersRepository\nlet subjectsRepository: SubjectsRepository\nlet trailsRepository: TrailsRepository\nlet professorsRepository: ProfessorsRepository\n\nlet author: User\nlet trail: Trail\n\nlet sut: PublishProjectUseCase\n\ndescribe('publish project use case', () => {\n  beforeEach(async () => {\n    studentsRepository = new InMemoryUsersRepository()\n    subjectsRepository = new InMemorySubjectsRepository()\n    trailsRepository = new InMemoryTrailsRepository()\n    professorsRepository = new InMemoryProfessorsRepository()\n\n    projectsRepository = new InMemoryProjectsRepository(\n      studentsRepository,\n      subjectsRepository,\n      trailsRepository,\n      professorsRepository,\n    )\n\n    author = await makeUser()\n    trail = makeTrail()\n\n    sut = new PublishProjectUseCase(\n      projectsRepository,\n      studentsRepository,\n      subjectsRepository,\n      trailsRepository,\n      professorsRepository,\n    )\n  })\n\n  it('should be able to publish a project', async () => {\n    await studentsRepository.create(author)\n    await trailsRepository.create(trail)\n\n    const result = await sut.execute({\n      title: 'Project Title',\n      description: 'Project Description',\n      bannerUrl: 'https://banner-url.com',\n      publishedYear: 2021,\n      semester: 1,\n      allowComments: true,\n      authorId: author.id.toString(),\n      trailsIds: [trail.id.toString()],\n    })\n\n    expect(result.isRight()).toBe(true)\n    expect(result.isRight() && result.value).toMatchObject({\n      projectId: expect.any(String),\n    })\n  })\n\n  it('should be able to publish a project with a subject', async () => {\n    const subject = makeSubject()\n\n    await studentsRepository.create(author)\n    await trailsRepository.create(trail)\n    await subjectsRepository.create(subject)\n\n    const result = await sut.execute({\n      title: 'Project Title',\n      description: 'Project Description',\n      bannerUrl: 'https://banner-url.com',\n      publishedYear: 2021,\n      semester: 1,\n      allowComments: true,\n      authorId: author.id.toString(),\n      trailsIds: [trail.id.toString()],\n      subjectId: subject.id.toString(),\n    })\n\n    expect(result.isRight()).toBe(true)\n    expect(result.isRight() && result.value).toMatchObject({\n      projectId: expect.any(String),\n    })\n  })\n\n  it('should be able to publish a project with professors', async () => {\n    const professor = makeProfessor()\n\n    await studentsRepository.create(author)\n    await trailsRepository.create(trail)\n    await professorsRepository.create(professor)\n\n    const result = await sut.execute({\n      title: 'Project Title',\n      description: 'Project Description',\n      bannerUrl: 'https://banner-url.com',\n      publishedYear: 2021,\n      semester: 1,\n      allowComments: true,\n      authorId: author.id.toString(),\n      trailsIds: [trail.id.toString()],\n      professorsIds: [professor.id.toString()],\n    })\n\n    expect(result.isRight()).toBe(true)\n    expect(result.isRight() && result.value).toMatchObject({\n      projectId: expect.any(String),\n    })\n  })\n\n  it('should not be able to publish a project with a non-existing student', async () => {\n    await trailsRepository.create(trail)\n\n    const result = await sut.execute({\n      title: 'Project Title',\n      description: 'Project Description',\n      bannerUrl: 'https://banner-url.com',\n      publishedYear: 2021,\n      semester: 1,\n      allowComments: true,\n      authorId: 'non-existing-student-id',\n      trailsIds: [trail.id.toString()],\n    })\n\n    expect(result.isLeft()).toBe(true)\n    expect(result.isLeft() && result.value).toBeInstanceOf(\n      ResourceNotFoundError,\n    )\n  })\n\n  it('should not be able to publish a project with a non-existing trail', async () => {\n    await studentsRepository.create(author)\n\n    const result = await sut.execute({\n      title: 'Project Title',\n      description: 'Project Description',\n      bannerUrl: 'https://banner-url.com',\n      publishedYear: 2021,\n      semester: 1,\n      allowComments: true,\n      authorId: author.id.toString(),\n      trailsIds: ['non-existing-trail-id'],\n    })\n\n    expect(result.isLeft()).toBe(true)\n    expect(result.isLeft() && result.value).toBeInstanceOf(\n      ResourceNotFoundError,\n    )\n  })\n\n  it('should not be able to publish a project with a non-existing subject', async () => {\n    await studentsRepository.create(author)\n    await trailsRepository.create(trail)\n\n    const result = await sut.execute({\n      title: 'Project Title',\n      description: 'Project Description',\n      bannerUrl: 'https://banner-url.com',\n      publishedYear: 2021,\n      semester: 1,\n      allowComments: true,\n      authorId: author.id.toString(),\n      trailsIds: [trail.id.toString()],\n      subjectId: 'non-existing-subject-id',\n    })\n\n    expect(result.isLeft()).toBe(true)\n    expect(result.isLeft() && result.value).toBeInstanceOf(\n      ResourceNotFoundError,\n    )\n  })\n})\n"],"names":["projectsRepository","studentsRepository","subjectsRepository","trailsRepository","professorsRepository","author","trail","sut","describe","beforeEach","InMemoryUsersRepository","InMemorySubjectsRepository","InMemoryTrailsRepository","InMemoryProfessorsRepository","InMemoryProjectsRepository","makeUser","makeTrail","PublishProjectUseCase","it","create","result","execute","title","description","bannerUrl","publishedYear","semester","allowComments","authorId","id","toString","trailsIds","expect","isRight","toBe","value","toMatchObject","projectId","any","String","subject","makeSubject","subjectId","professor","makeProfessor","professorsIds","isLeft","toBeInstanceOf","ResourceNotFoundError"],"mappings":"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"}