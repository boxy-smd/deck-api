{"version":3,"sources":["../../../../../src/domain/projects/application/use-cases/create-draft.ts"],"sourcesContent":["import type { UsersRepository } from '@/domain/authentication/application/repositories/users-repository'\nimport { type Either, left, right } from '@/shared/either'\nimport { ForbiddenError } from '@/shared/errors/forbidden.error'\nimport { ResourceNotFoundError } from '@/shared/errors/resource-not-found.error'\nimport { UniqueEntityID } from '@/shared/kernel/unique-entity-id'\nimport { Project } from '../../enterprise/entities/project'\nimport type { Subject } from '../../enterprise/entities/subject'\nimport { ProjectStatus } from '../../enterprise/value-objects/project-status'\nimport type { ProfessorsRepository } from '../repositories/professors-repository'\nimport type { ProjectsRepository } from '../repositories/projects-repository'\nimport type { SubjectsRepository } from '../repositories/subjects-repository'\nimport type { TrailsRepository } from '../repositories/trails-repository'\n\ninterface CreateDraftUseCaseRequest {\n  title: string\n  description?: string\n  bannerUrl?: string\n  content?: string\n  publishedYear?: number\n  semester?: number\n  allowComments?: boolean\n  authorId: string\n  subjectId?: string\n  trailsIds?: string[]\n  professorsIds?: string[]\n}\n\ntype CreateDraftUseCaseResponse = Either<\n  ForbiddenError | ResourceNotFoundError,\n  {\n    draftId: string\n  }\n>\n\nexport class CreateDraftUseCase {\n  constructor(\n    private readonly projectsRepository: ProjectsRepository,\n    private readonly usersRepository: UsersRepository,\n    private readonly subjectsRepository: SubjectsRepository,\n    private readonly trailsRepository: TrailsRepository,\n    private readonly professorsRepository: ProfessorsRepository,\n  ) {}\n\n  async execute({\n    title,\n    description,\n    bannerUrl,\n    content,\n    publishedYear,\n    semester,\n    allowComments,\n    authorId,\n    subjectId,\n    trailsIds,\n    professorsIds,\n  }: CreateDraftUseCaseRequest): Promise<CreateDraftUseCaseResponse> {\n    if (!authorId) {\n      return left(\n        new ForbiddenError('Você deve estar logado para criar um rascunho.'),\n      )\n    }\n\n    if (!title) {\n      return left(\n        new ForbiddenError('Você deve fornecer um título para o rascunho.'),\n      )\n    }\n\n    const student = await this.usersRepository.findById(authorId)\n\n    if (!student) {\n      return left(new ResourceNotFoundError('Estudante não encontrado.'))\n    }\n\n    if (!this.subjectsRepository.existsById(new UniqueEntityID(subjectId))) {\n      return left(new ResourceNotFoundError('Disciplina não encontrada.'))\n    }\n\n    for (const trailId of trailsIds ?? []) {\n      if (\n        !(await this.trailsRepository.existsById(new UniqueEntityID(trailId)))\n      ) {\n        return left(new ResourceNotFoundError('Trilha não encontrada.'))\n      }\n    }\n\n    for (const professorId of professorsIds ?? []) {\n      if (\n        !(await this.professorsRepository.existsById(\n          new UniqueEntityID(professorId),\n        ))\n      ) {\n        return left(new ResourceNotFoundError('Professor não encontrado.'))\n      }\n    }\n\n    const draft = Project.create({\n      title,\n      description,\n      bannerUrl,\n      content,\n      publishedYear,\n      semester,\n      allowComments: allowComments ?? false,\n      authorId: student.id,\n      subjectId: new UniqueEntityID<Subject>(subjectId),\n      status: ProjectStatus.DRAFT,\n    })\n\n    draft.defineTrails(\n      trailsIds?.map(trailId => new UniqueEntityID(trailId)) ?? [],\n    )\n\n    draft.defineProfessors(\n      professorsIds?.map(professorId => new UniqueEntityID(professorId)) ?? [],\n    )\n\n    await this.projectsRepository.create(draft)\n\n    return right({\n      draftId: draft.id.toString(),\n    })\n  }\n}\n"],"names":["CreateDraftUseCase","execute","title","description","bannerUrl","content","publishedYear","semester","allowComments","authorId","subjectId","trailsIds","professorsIds","left","ForbiddenError","student","usersRepository","findById","ResourceNotFoundError","subjectsRepository","existsById","UniqueEntityID","trailId","trailsRepository","professorId","professorsRepository","draft","Project","create","id","status","ProjectStatus","DRAFT","defineTrails","map","defineProfessors","projectsRepository","right","draftId","toString"],"mappings":";;;;+BAkCaA;;;eAAAA;;;wBAjC4B;gCACV;uCACO;gCACP;yBACP;+BAEM;AA2BvB,IAAA,AAAMA,qBAAN,MAAMA;IASX,MAAMC,QAAQ,EACZC,KAAK,EACLC,WAAW,EACXC,SAAS,EACTC,OAAO,EACPC,aAAa,EACbC,QAAQ,EACRC,aAAa,EACbC,QAAQ,EACRC,SAAS,EACTC,SAAS,EACTC,aAAa,EACa,EAAuC;QACjE,IAAI,CAACH,UAAU;YACb,OAAOI,IAAAA,YAAI,EACT,IAAIC,8BAAc,CAAC;QAEvB;QAEA,IAAI,CAACZ,OAAO;YACV,OAAOW,IAAAA,YAAI,EACT,IAAIC,8BAAc,CAAC;QAEvB;QAEA,MAAMC,UAAU,MAAM,IAAI,CAACC,eAAe,CAACC,QAAQ,CAACR;QAEpD,IAAI,CAACM,SAAS;YACZ,OAAOF,IAAAA,YAAI,EAAC,IAAIK,4CAAqB,CAAC;QACxC;QAEA,IAAI,CAAC,IAAI,CAACC,kBAAkB,CAACC,UAAU,CAAC,IAAIC,8BAAc,CAACX,aAAa;YACtE,OAAOG,IAAAA,YAAI,EAAC,IAAIK,4CAAqB,CAAC;QACxC;QAEA,KAAK,MAAMI,WAAWX,aAAa,EAAE,CAAE;YACrC,IACE,CAAE,MAAM,IAAI,CAACY,gBAAgB,CAACH,UAAU,CAAC,IAAIC,8BAAc,CAACC,WAC5D;gBACA,OAAOT,IAAAA,YAAI,EAAC,IAAIK,4CAAqB,CAAC;YACxC;QACF;QAEA,KAAK,MAAMM,eAAeZ,iBAAiB,EAAE,CAAE;YAC7C,IACE,CAAE,MAAM,IAAI,CAACa,oBAAoB,CAACL,UAAU,CAC1C,IAAIC,8BAAc,CAACG,eAErB;gBACA,OAAOX,IAAAA,YAAI,EAAC,IAAIK,4CAAqB,CAAC;YACxC;QACF;QAEA,MAAMQ,QAAQC,gBAAO,CAACC,MAAM,CAAC;YAC3B1B;YACAC;YACAC;YACAC;YACAC;YACAC;YACAC,eAAeA,iBAAiB;YAChCC,UAAUM,QAAQc,EAAE;YACpBnB,WAAW,IAAIW,8BAAc,CAAUX;YACvCoB,QAAQC,4BAAa,CAACC,KAAK;QAC7B;QAEAN,MAAMO,YAAY,CAChBtB,WAAWuB,IAAIZ,CAAAA,UAAW,IAAID,8BAAc,CAACC,aAAa,EAAE;QAG9DI,MAAMS,gBAAgB,CACpBvB,eAAesB,IAAIV,CAAAA,cAAe,IAAIH,8BAAc,CAACG,iBAAiB,EAAE;QAG1E,MAAM,IAAI,CAACY,kBAAkB,CAACR,MAAM,CAACF;QAErC,OAAOW,IAAAA,aAAK,EAAC;YACXC,SAASZ,MAAMG,EAAE,CAACU,QAAQ;QAC5B;IACF;IAvFA,YACE,AAAiBH,kBAAsC,EACvD,AAAiBpB,eAAgC,EACjD,AAAiBG,kBAAsC,EACvD,AAAiBI,gBAAkC,EACnD,AAAiBE,oBAA0C,CAC3D;aALiBW,qBAAAA;aACApB,kBAAAA;aACAG,qBAAAA;aACAI,mBAAAA;aACAE,uBAAAA;IAChB;AAkFL"}