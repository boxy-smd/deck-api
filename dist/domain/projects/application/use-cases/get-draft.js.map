{"version":3,"sources":["../../../../../src/domain/projects/application/use-cases/get-draft.ts"],"sourcesContent":["import type { UsersRepository } from '@/domain/authentication/application/repositories/users-repository'\nimport type { ProjectsRepository } from '@/domain/projects/application/repositories/projects-repository'\nimport type { Project } from '@/domain/projects/enterprise/entities/project'\nimport { type Either, left, right } from '@/shared/either'\nimport { ForbiddenError } from '@/shared/errors/forbidden.error'\nimport { ResourceNotFoundError } from '@/shared/errors/resource-not-found.error'\n\ninterface GetDraftUseCaseRequest {\n  draftId: string\n  authorId: string\n}\n\ntype GetDraftUseCaseResponse = Either<\n  ResourceNotFoundError | ForbiddenError,\n  Project\n>\n\nexport class GetDraftUseCase {\n  constructor(\n    private projectsRepository: ProjectsRepository,\n    private studentsRepository: UsersRepository,\n  ) {}\n\n  async execute({\n    draftId,\n    authorId,\n  }: GetDraftUseCaseRequest): Promise<GetDraftUseCaseResponse> {\n    if (!authorId) {\n      return left(\n        new ForbiddenError('You are not allowed to access this resource.'),\n      )\n    }\n\n    const student = await this.studentsRepository.findById(authorId)\n\n    if (!student) {\n      return left(new ResourceNotFoundError('Student not found.'))\n    }\n\n    const draft = await this.projectsRepository.findById(draftId)\n\n    if (!draft) {\n      return left(new ResourceNotFoundError('Draft not found.'))\n    }\n\n    if (draft.authorId.toString() !== authorId) {\n      return left(\n        new ForbiddenError('You are not allowed to access this resource.'),\n      )\n    }\n\n    return right(draft)\n  }\n}\n"],"names":["GetDraftUseCase","execute","draftId","authorId","left","ForbiddenError","student","studentsRepository","findById","ResourceNotFoundError","draft","projectsRepository","toString","right"],"mappings":";;;;+BAiBaA;;;eAAAA;;;wBAd4B;gCACV;uCACO;AAY/B,IAAA,AAAMA,kBAAN,MAAMA;IAMX,MAAMC,QAAQ,EACZC,OAAO,EACPC,QAAQ,EACe,EAAoC;QAC3D,IAAI,CAACA,UAAU;YACb,OAAOC,IAAAA,YAAI,EACT,IAAIC,8BAAc,CAAC;QAEvB;QAEA,MAAMC,UAAU,MAAM,IAAI,CAACC,kBAAkB,CAACC,QAAQ,CAACL;QAEvD,IAAI,CAACG,SAAS;YACZ,OAAOF,IAAAA,YAAI,EAAC,IAAIK,4CAAqB,CAAC;QACxC;QAEA,MAAMC,QAAQ,MAAM,IAAI,CAACC,kBAAkB,CAACH,QAAQ,CAACN;QAErD,IAAI,CAACQ,OAAO;YACV,OAAON,IAAAA,YAAI,EAAC,IAAIK,4CAAqB,CAAC;QACxC;QAEA,IAAIC,MAAMP,QAAQ,CAACS,QAAQ,OAAOT,UAAU;YAC1C,OAAOC,IAAAA,YAAI,EACT,IAAIC,8BAAc,CAAC;QAEvB;QAEA,OAAOQ,IAAAA,aAAK,EAACH;IACf;IAlCA,YACE,AAAQC,kBAAsC,EAC9C,AAAQJ,kBAAmC,CAC3C;aAFQI,qBAAAA;aACAJ,qBAAAA;IACP;AAgCL"}