{"version":3,"sources":["../../../../../src/domain/authentication/enterprise/entities/user.ts"],"sourcesContent":["import { AggregateRoot } from '@/shared/kernel/aggregate-root'\nimport type { UniqueEntityID } from '@/shared/kernel/unique-entity-id'\nimport type { Email } from '../value-objects/email'\nimport { Semester } from '../value-objects/semester'\nimport type { UserRole } from '../value-objects/user-role'\nimport { UserStatus } from '../value-objects/user-status'\nimport type { Username } from '../value-objects/username'\nimport { StudentProfile } from './student-profile'\n\nexport interface UserProps {\n  name: string\n  username: Username\n  email: Email\n  passwordHash: string\n  about?: string\n  profileUrl?: string\n  role: UserRole\n  status: UserStatus\n\n  profile?: StudentProfile\n}\n\nexport class User extends AggregateRoot<UserProps> {\n  // --- 1. Factory methods ---\n  static create(props: UserProps, id?: UniqueEntityID<User>): User {\n    return new User(props, id)\n  }\n\n  static reconstitute(\n    props: UserProps,\n    id: UniqueEntityID,\n    createdAt: Date,\n    updatedAt: Date,\n  ): User {\n    return new User(props, id, createdAt, updatedAt)\n  }\n\n  // --- 2. Public methods ---\n  public updateAbout(about: string | undefined): void {\n    // TODO: Define a value object for about\n    this.props.about = about\n    this.touch()\n  }\n\n  public changeProfilePicture(profileUrl: string | undefined): void {\n    this.props.profileUrl = profileUrl\n    this.touch()\n  }\n\n  public isActive(): boolean {\n    return this.props.status === UserStatus.ACTIVE\n  }\n\n  public activate(): void {\n    this.props.status = UserStatus.ACTIVE\n    this.touch()\n  }\n\n  public isInactive(): boolean {\n    return this.props.status === UserStatus.INACTIVE\n  }\n\n  public inactivate(): void {\n    this.props.status = UserStatus.INACTIVE\n    this.touch()\n  }\n\n  public isBanned(): boolean {\n    return this.props.status === UserStatus.BANNED\n  }\n\n  public ban() {\n    this.props.status = UserStatus.BANNED\n    this.touch()\n  }\n\n  public unban() {\n    this.props.status = UserStatus.ACTIVE\n    this.touch()\n  }\n\n  public changeRole(role: UserRole) {\n    this.props.role = role\n    this.touch()\n  }\n\n  public createProfile(semester: number) {\n    if (this.props.profile) {\n      throw new Error('O usuário já possui um perfil de estudante.')\n    }\n\n    const validatedSemester = Semester.create(semester)\n\n    if (validatedSemester.isLeft()) {\n      throw validatedSemester.value\n    }\n\n    const studentProfile = StudentProfile.create(\n      {\n        semester: validatedSemester.value,\n      },\n      this.id,\n    )\n\n    this.props.profile = studentProfile\n    this.touch()\n  }\n\n  public addTrailToProfile(trailId: UniqueEntityID) {\n    if (!this.props.profile) {\n      throw new Error('O usuário não possui um perfil de estudante.')\n    }\n\n    this.props.profile.addTrail(trailId)\n    this.touch()\n  }\n\n  public removeTrailFromProfile(trailId: UniqueEntityID) {\n    if (!this.props.profile) {\n      throw new Error('O usuário não possui um perfil de estudante.')\n    }\n\n    this.props.profile.removeTrail(trailId)\n    this.touch()\n  }\n\n  // --- 3. Getters ---\n  get name() {\n    return this.props.name\n  }\n\n  get username() {\n    return this.props.username\n  }\n\n  get email() {\n    return this.props.email\n  }\n\n  get passwordHash() {\n    return this.props.passwordHash\n  }\n\n  get about() {\n    return this.props.about\n  }\n\n  get profileUrl() {\n    return this.props.profileUrl\n  }\n\n  get role() {\n    return this.props.role\n  }\n\n  get status() {\n    return this.props.status\n  }\n\n  get profile() {\n    return this.props.profile\n  }\n}\n"],"names":["User","AggregateRoot","create","props","id","reconstitute","createdAt","updatedAt","updateAbout","about","touch","changeProfilePicture","profileUrl","isActive","status","UserStatus","ACTIVE","activate","isInactive","INACTIVE","inactivate","isBanned","BANNED","ban","unban","changeRole","role","createProfile","semester","profile","Error","validatedSemester","Semester","isLeft","value","studentProfile","StudentProfile","addTrailToProfile","trailId","addTrail","removeTrailFromProfile","removeTrail","name","username","email","passwordHash"],"mappings":"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"}