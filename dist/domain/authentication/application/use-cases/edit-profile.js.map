{"version":3,"sources":["../../../../../src/domain/authentication/application/use-cases/edit-profile.ts"],"sourcesContent":["import type { TrailsRepository } from '@/domain/projects/application/repositories/trails-repository'\nimport { type Either, left, right } from '@/shared/either'\nimport type { InvalidCredentialsError } from '@/shared/errors/invalid-credentials.error'\nimport type { ResourceAlreadyExistsError } from '@/shared/errors/resource-already-exists.error'\nimport { ResourceNotFoundError } from '@/shared/errors/resource-not-found.error'\nimport type { User } from '../../enterprise/entities/user'\nimport { Semester } from '../../enterprise/value-objects/semester'\nimport type { SemesterOutOfBoundsError } from '../errors/semester-out-of-bounds.error'\nimport type { UsersRepository } from '../repositories/users-repository'\n\ninterface EditProfileUseCaseRequest {\n  studentId: string\n  about?: string\n  semester?: number\n  profileUrl?: string\n  trailsIds?: string[]\n}\n\ntype EditProfileUseCaseResponse = Either<\n  | InvalidCredentialsError\n  | ResourceNotFoundError\n  | ResourceAlreadyExistsError\n  | SemesterOutOfBoundsError,\n  User\n>\n\nexport class EditProfileUseCase {\n  constructor(\n    private readonly usersRepository: UsersRepository,\n    private readonly trailsRepository: TrailsRepository,\n  ) {}\n\n  async execute({\n    studentId,\n    about,\n    semester,\n    profileUrl,\n    trailsIds,\n  }: EditProfileUseCaseRequest): Promise<EditProfileUseCaseResponse> {\n    const student = await this.usersRepository.findById(studentId)\n\n    if (!student?.profile) {\n      return left(new ResourceNotFoundError('Student not found.'))\n    }\n\n    const newSemester = Semester.create(\n      semester ?? student.profile.semester.value,\n    )\n\n    if (newSemester.isLeft()) {\n      return left(newSemester.value)\n    }\n\n    student.updateAbout(about ?? student.about)\n    student.profile.updateSemester(newSemester.value as Semester)\n    student.changeProfilePicture(profileUrl ?? student.profileUrl)\n\n    for (const trailId of trailsIds ?? []) {\n      const trail = await this.trailsRepository.findById(trailId)\n\n      if (!trail) {\n        return left(\n          new ResourceNotFoundError(`Trail with ID ${trailId} not found.`),\n        )\n      }\n\n      student.addTrailToProfile(trail.id)\n    }\n\n    await this.usersRepository.save(student)\n\n    return right(student)\n  }\n}\n"],"names":["EditProfileUseCase","execute","studentId","about","semester","profileUrl","trailsIds","student","usersRepository","findById","profile","left","ResourceNotFoundError","newSemester","Semester","create","value","isLeft","updateAbout","updateSemester","changeProfilePicture","trailId","trail","trailsRepository","addTrailToProfile","id","save","right"],"mappings":";;;;+BA0BaA;;;eAAAA;;;wBAzB4B;uCAGH;0BAEb;AAoBlB,IAAA,AAAMA,qBAAN,MAAMA;IAMX,MAAMC,QAAQ,EACZC,SAAS,EACTC,KAAK,EACLC,QAAQ,EACRC,UAAU,EACVC,SAAS,EACiB,EAAuC;QACjE,MAAMC,UAAU,MAAM,IAAI,CAACC,eAAe,CAACC,QAAQ,CAACP;QAEpD,IAAI,CAACK,SAASG,SAAS;YACrB,OAAOC,IAAAA,YAAI,EAAC,IAAIC,4CAAqB,CAAC;QACxC;QAEA,MAAMC,cAAcC,kBAAQ,CAACC,MAAM,CACjCX,YAAYG,QAAQG,OAAO,CAACN,QAAQ,CAACY,KAAK;QAG5C,IAAIH,YAAYI,MAAM,IAAI;YACxB,OAAON,IAAAA,YAAI,EAACE,YAAYG,KAAK;QAC/B;QAEAT,QAAQW,WAAW,CAACf,SAASI,QAAQJ,KAAK;QAC1CI,QAAQG,OAAO,CAACS,cAAc,CAACN,YAAYG,KAAK;QAChDT,QAAQa,oBAAoB,CAACf,cAAcE,QAAQF,UAAU;QAE7D,KAAK,MAAMgB,WAAWf,aAAa,EAAE,CAAE;YACrC,MAAMgB,QAAQ,MAAM,IAAI,CAACC,gBAAgB,CAACd,QAAQ,CAACY;YAEnD,IAAI,CAACC,OAAO;gBACV,OAAOX,IAAAA,YAAI,EACT,IAAIC,4CAAqB,CAAC,CAAC,cAAc,EAAES,QAAQ,WAAW,CAAC;YAEnE;YAEAd,QAAQiB,iBAAiB,CAACF,MAAMG,EAAE;QACpC;QAEA,MAAM,IAAI,CAACjB,eAAe,CAACkB,IAAI,CAACnB;QAEhC,OAAOoB,IAAAA,aAAK,EAACpB;IACf;IA7CA,YACE,AAAiBC,eAAgC,EACjD,AAAiBe,gBAAkC,CACnD;aAFiBf,kBAAAA;aACAe,mBAAAA;IAChB;AA2CL"}