{"version":3,"sources":["../src/app.ts"],"sourcesContent":["import fastifyCookie from '@fastify/cookie'\nimport fastifyCors from '@fastify/cors'\nimport fastifyJWT from '@fastify/jwt'\nimport fastifyMultipart from '@fastify/multipart'\nimport fastifySwagger from '@fastify/swagger'\nimport fastifyScalar from '@scalar/fastify-api-reference'\nimport { fastify } from 'fastify'\nimport {\n  jsonSchemaTransform,\n  serializerCompiler,\n  validatorCompiler,\n} from 'fastify-type-provider-zod'\n\nimport { envToLogger } from '@/infra/config/env/env-to-logger'\nimport { env } from '@/infra/config/env/env'\nimport { errorHandler } from '@/interface/error-handler'\nimport { studentsRoutes } from '@/interface/http/routes/students.routes'\nimport { commentsRoutes } from './interface/http/routes/comments.routes'\nimport { professorsRoutes } from './interface/http/routes/professors.routes'\nimport { projectsRoutes } from './interface/http/routes/projects.routes'\nimport { subjectsRoutes } from './interface/http/routes/subjects.routes'\nimport { trailsRoutes } from './interface/http/routes/trails.routes'\n\nasync function buildServer() {\n  const app = fastify({\n    logger: envToLogger[env.NODE_ENV],\n  })\n\n  app.register(fastifyCors, {\n    origin: ['http://localhost:3000', 'https://deck-smd.vercel.app'],\n    credentials: true,\n  })\n\n  app.register(fastifyJWT, {\n    cookie: {\n      cookieName: 'refreshToken',\n      signed: false,\n    },\n    secret: env.JWT_SECRET,\n  })\n\n  app.register(fastifyCookie, {\n    secret: env.JWT_SECRET,\n  })\n\n  app.register(fastifyMultipart, {\n    limits: {\n      files: 1,\n      fileSize: 5 * 1024 * 1024, // 5MB\n    },\n  })\n\n  app.setValidatorCompiler(validatorCompiler)\n  app.setSerializerCompiler(serializerCompiler)\n\n  app.register(fastifySwagger, {\n    swagger: {\n      consumes: ['application/json'],\n      produces: ['application/json'],\n      info: {\n        title: 'Deck API',\n        contact: {\n          name: 'Boxy Team',\n          email: 'boxy@gmail.com',\n        },\n        description:\n          'Esse é o backend do projeto **Deck**, um projeto de uma aplicação que servirá como repositório de trabalhos realizados por alunos do curso de Sistemas e Mídias Digitais da Universidade Federal do Ceará.',\n        version: '1.0.0',\n      },\n      tags: [\n        { name: 'Students', description: 'Operations related to students' },\n        { name: 'Professors', description: 'Operations related to professors' },\n        { name: 'Subjects', description: 'Operations related to subjects' },\n        { name: 'Trails', description: 'Operations related to trails' },\n        { name: 'Projects', description: 'Operations related to projects' },\n        { name: 'Comments', description: 'Operations related to comments' },\n        { name: 'Reports', description: 'Operations related to reports' },\n      ],\n    },\n    transform: jsonSchemaTransform,\n  })\n\n  app.register(fastifyScalar, {\n    routePrefix: '/docs',\n    configuration: {\n      title: 'Deck API',\n      spec: {\n        content: () => app.swagger(),\n      },\n      theme: 'purple',\n      metaData: {\n        title: 'Deck API Reference',\n        description: 'API Reference for Deck API',\n      },\n    },\n  })\n\n  app.register(studentsRoutes)\n  app.register(subjectsRoutes)\n  app.register(professorsRoutes)\n  app.register(trailsRoutes)\n  app.register(projectsRoutes)\n  app.register(commentsRoutes)\n\n  app.get('/health-check', () => {\n    return {\n      status: 'ok',\n    }\n  })\n\n  app.get('/swagger.json', () => {\n    return app.swagger()\n  })\n\n  app.setErrorHandler(errorHandler)\n\n  return app\n}\n\nexport const app = await buildServer()\n"],"names":["app","buildServer","fastify","logger","envToLogger","env","NODE_ENV","register","fastifyCors","origin","credentials","fastifyJWT","cookie","cookieName","signed","secret","JWT_SECRET","fastifyCookie","fastifyMultipart","limits","files","fileSize","setValidatorCompiler","validatorCompiler","setSerializerCompiler","serializerCompiler","fastifySwagger","swagger","consumes","produces","info","title","contact","name","email","description","version","tags","transform","jsonSchemaTransform","fastifyScalar","routePrefix","configuration","spec","content","theme","metaData","studentsRoutes","subjectsRoutes","professorsRoutes","trailsRoutes","projectsRoutes","commentsRoutes","get","status","setErrorHandler","errorHandler"],"mappings":";;;;+BAuHaA;;;eAAAA;;;+DAvHa;6DACF;4DACD;kEACM;gEACF;4EACD;yBACF;wCAKjB;6BAEqB;qBACR;8BACS;gCACE;gCACA;kCACE;gCACF;gCACA;8BACF;;;;;;AAE7B,eAAeC;IACb,MAAMD,MAAME,IAAAA,gBAAO,EAAC;QAClBC,QAAQC,wBAAW,CAACC,QAAG,CAACC,QAAQ,CAAC;IACnC;IAEAN,IAAIO,QAAQ,CAACC,aAAW,EAAE;QACxBC,QAAQ;YAAC;YAAyB;SAA8B;QAChEC,aAAa;IACf;IAEAV,IAAIO,QAAQ,CAACI,YAAU,EAAE;QACvBC,QAAQ;YACNC,YAAY;YACZC,QAAQ;QACV;QACAC,QAAQV,QAAG,CAACW,UAAU;IACxB;IAEAhB,IAAIO,QAAQ,CAACU,eAAa,EAAE;QAC1BF,QAAQV,QAAG,CAACW,UAAU;IACxB;IAEAhB,IAAIO,QAAQ,CAACW,kBAAgB,EAAE;QAC7BC,QAAQ;YACNC,OAAO;YACPC,UAAU,IAAI,OAAO;QACvB;IACF;IAEArB,IAAIsB,oBAAoB,CAACC,yCAAiB;IAC1CvB,IAAIwB,qBAAqB,CAACC,0CAAkB;IAE5CzB,IAAIO,QAAQ,CAACmB,gBAAc,EAAE;QAC3BC,SAAS;YACPC,UAAU;gBAAC;aAAmB;YAC9BC,UAAU;gBAAC;aAAmB;YAC9BC,MAAM;gBACJC,OAAO;gBACPC,SAAS;oBACPC,MAAM;oBACNC,OAAO;gBACT;gBACAC,aACE;gBACFC,SAAS;YACX;YACAC,MAAM;gBACJ;oBAAEJ,MAAM;oBAAYE,aAAa;gBAAiC;gBAClE;oBAAEF,MAAM;oBAAcE,aAAa;gBAAmC;gBACtE;oBAAEF,MAAM;oBAAYE,aAAa;gBAAiC;gBAClE;oBAAEF,MAAM;oBAAUE,aAAa;gBAA+B;gBAC9D;oBAAEF,MAAM;oBAAYE,aAAa;gBAAiC;gBAClE;oBAAEF,MAAM;oBAAYE,aAAa;gBAAiC;gBAClE;oBAAEF,MAAM;oBAAWE,aAAa;gBAAgC;aACjE;QACH;QACAG,WAAWC,2CAAmB;IAChC;IAEAvC,IAAIO,QAAQ,CAACiC,4BAAa,EAAE;QAC1BC,aAAa;QACbC,eAAe;YACbX,OAAO;YACPY,MAAM;gBACJC,SAAS,IAAM5C,IAAI2B,OAAO;YAC5B;YACAkB,OAAO;YACPC,UAAU;gBACRf,OAAO;gBACPI,aAAa;YACf;QACF;IACF;IAEAnC,IAAIO,QAAQ,CAACwC,8BAAc;IAC3B/C,IAAIO,QAAQ,CAACyC,8BAAc;IAC3BhD,IAAIO,QAAQ,CAAC0C,kCAAgB;IAC7BjD,IAAIO,QAAQ,CAAC2C,0BAAY;IACzBlD,IAAIO,QAAQ,CAAC4C,8BAAc;IAC3BnD,IAAIO,QAAQ,CAAC6C,8BAAc;IAE3BpD,IAAIqD,GAAG,CAAC,iBAAiB;QACvB,OAAO;YACLC,QAAQ;QACV;IACF;IAEAtD,IAAIqD,GAAG,CAAC,iBAAiB;QACvB,OAAOrD,IAAI2B,OAAO;IACpB;IAEA3B,IAAIuD,eAAe,CAACC,0BAAY;IAEhC,OAAOxD;AACT;AAEO,MAAMA,MAAM,MAAMC"}